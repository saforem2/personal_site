<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sam Foreman">
<meta name="dcterms.date" content="2024-08-23">

<title>üçã ezpz @ ALCF ‚Äì Sam Foreman</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/favicon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-7792cb2d1a7892d7a8bef61f0af1121c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-b9fb04538367f6077b03b31e71ed1601.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": true,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XVM2Y822Y1"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XVM2Y822Y1', { 'anonymize_ip': true});
</script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-TC329HJ');</script>
<!-- End Google Tag Manager -->
<link href="https://iosevka-webfonts.github.io/iosevkatermss15/IosevkaTermSS15.css" rel="stylesheet">

  <script defer="" src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../css/custom.css">
<link rel="stylesheet" href="../../css/ibm-plex.css">
<link rel="stylesheet" href="../../static/fonts/IosevkaAileSansQPss15/IosevkaAileSansQPss15.css">
<link rel="stylesheet" href="../../static/fonts/IosevkaSansTerminalss15Custom/IosevkaSansTerminalss15Custom.css">
<link rel="stylesheet" href="../../static/fonts/iosevka-custom/iosevka-custom.css">
<meta property="og:title" content="üçã ezpz @ ALCF">
<meta property="og:description" content="üçã ezpz at ALCF">
<meta property="og:image" content="https://samforeman.me/posts/ezpz-at-alcf/assets/thumbnail.png">
<meta property="og:site_name" content="Sam Foreman">
<meta name="twitter:title" content="üçã ezpz @ ALCF">
<meta name="twitter:description" content="üçã ezpz at ALCF">
<meta name="twitter:image" content="https://samforeman.me/posts/ezpz-at-alcf/assets/thumbnail.png">
<meta name="twitter:creator" content="saforem2">
<meta name="twitter:site" content="saforem2">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="üçã ezpz at ALCF">
<meta name="citation_author" content="Sam Foreman">
<meta name="citation_publication_date" content="2024-08-23">
<meta name="citation_cover_date" content="2024-08-23">
<meta name="citation_year" content="2024">
<meta name="citation_online_date" content="2024-08-23">
<meta name="citation_fulltext_html_url" content="https://samforeman.me/posts/ezpz-at-alcf">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Superconductivity of in and sn samples;,citation_author=George Deamont;,citation_author=Sam Foreman;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;">
<meta name="citation_reference" content="citation_title=RG-inspired machine learning for lattice field theory;,citation_author=Sam Foreman;,citation_author=Joel Giedt;,citation_author=Yannick Meurice;,citation_author=Judah Unmuth-Yockey;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_volume=175;,citation_conference_title=EPJ web of conferences;,citation_conference=EDP Sciences;">
<meta name="citation_reference" content="citation_title=Large energy density in three-plate nanocapacitors due to coulomb blockade;,citation_author=A Hubler;,citation_author=S Foreman;,citation_author=J Liu;,citation_author=L Wortsmann;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=10;,citation_volume=123;,citation_journal_title=Journal of Applied Physics;,citation_publisher=AIP Publishing;">
<meta name="citation_reference" content="citation_title=Examples of renormalization group transformations for image sets;,citation_author=Samuel Foreman;,citation_author=Joel Giedt;,citation_author=Yannick Meurice;,citation_author=Judah Unmuth-Yockey;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=5;,citation_volume=98;,citation_journal_title=Physical Review E;,citation_publisher=American Physical Society;">
<meta name="citation_reference" content="citation_title=Machine learning inspired analysis of the ising model transition;,citation_author=Samuel Foreman;,citation_author=Joel Giedt;,citation_author=Yannick Meurice;,citation_author=Judah Unmuth-Yockey;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_conference_title=Lattice 2018;">
<meta name="citation_reference" content="citation_title=Learning better physics: A machine learning approach to lattice gauge theory;,citation_author=Samuel Alfred Foreman;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_dissertation_institution=University of Iowa;">
<meta name="citation_reference" content="citation_title=Machine learning and neural networks for field theory;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C Osborn;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;">
<meta name="citation_reference" content="citation_title=Deep learning hamiltonian monte carlo;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C Osborn;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_journal_title=arXiv preprint arXiv:2105.03418;">
<meta name="citation_reference" content="citation_title=HMC with normalizing flows;,citation_author=Sam Foreman;,citation_author=Taku Izubuchi;,citation_author=Luchang Jin;,citation_author=Xiao-Yong Jin;,citation_author=James C Osborn;,citation_author=Akio Tomiya;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_journal_title=arXiv preprint arXiv:2112.01586;">
<meta name="citation_reference" content="citation_title=LeapfrogLayers: A trainable framework for effective topological sampling;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C Osborn;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_journal_title=arXiv preprint arXiv:2112.01582;">
<meta name="citation_reference" content="citation_title=Energy storage in quantum resonators;,citation_author=Jiaqi Liu;,citation_author=Alfred W Hubler;,citation_author=Samuel Alfred Foreman;,citation_author=Katharina Ott;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;">
<meta name="citation_reference" content="citation_title=Applications of machine learning to lattice quantum field theory;,citation_author=Denis Boyda;,citation_author=Salvatore Calƒ±ÃÄ;,citation_author=Sam Foreman;,citation_author=Lena Funcke;,citation_author=Daniel C Hackett;,citation_author=Yin Lin;,citation_author=Gert Aarts;,citation_author=Andrei Alexandru;,citation_author=Xiao-Yong Jin;,citation_author=Biagio Lucini;,citation_author=others;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_journal_title=arXiv preprint arXiv:2202.05838;">
<meta name="citation_reference" content="citation_title=Lattice QCD and particle physics;,citation_author=Andreas S Kronfeld;,citation_author=Tanmoy Bhattacharya;,citation_author=Thomas Blum;,citation_author=Norman H Christ;,citation_author=Carleton DeTar;,citation_author=William Detmold;,citation_author=Robert Edwards;,citation_author=Anna Hasenfratz;,citation_author=Huey-Wen Lin;,citation_author=Swagato Mukherjee;,citation_author=others;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_journal_title=arXiv preprint arXiv:2207.07641;">
<meta name="citation_reference" content="citation_title=GenSLMs: Genome-scale language models reveal SARS-CoV-2 evolutionary dynamics;,citation_author=Maxim Zvyagin;,citation_author=Alexander Brace;,citation_author=Kyle Hippe;,citation_author=Yuntian Deng;,citation_author=Bin Zhang;,citation_author=Cindy Orozco Bohorquez;,citation_author=Austin Clyde;,citation_author=Bharat Kale;,citation_author=Danilo Perez-Rivera;,citation_author=Heng Ma;,citation_author=others;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=6;,citation_volume=37;,citation_journal_title=The International Journal of High Performance Computing Applications;,citation_publisher=SAGE Publications Sage UK: London, England;">
<meta name="citation_reference" content="citation_title=MLMC: Machine learning monte carlo;,citation_author=Sam Foreman;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_conference_title=The international symposium on lattice field theory;">
<meta name="citation_reference" content="citation_title=Superconductivity of in and sn samples;,citation_author=George Deamont;,citation_author=Sam Foreman;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;">
<meta name="citation_reference" content="citation_title=A comprehensive performance study of large language models on novel AI accelerators;,citation_author=Murali Emani;,citation_author=Sam Foreman;,citation_author=Varuni Sastry;,citation_author=Zhen Xie;,citation_author=Siddhisanket Raskar;,citation_author=William Arnold;,citation_author=Rajeev Thakur;,citation_author=Venkatram Vishwanath;,citation_author=Michael E Papka;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_journal_title=arXiv preprint arXiv:2310.04607;">
<meta name="citation_reference" content="citation_title=DeepSpeed4Science initiative: Enabling large-scale scientific discovery through sophisticated AI system technologies;,citation_author=Shuaiwen Leon Song;,citation_author=Bonnie Kruft;,citation_author=Minjia Zhang;,citation_author=Conglong Li;,citation_author=Shiyang Chen;,citation_author=Chengming Zhang;,citation_author=Masahiro Tanaka;,citation_author=Xiaoxia Wu;,citation_author=Jeff Rasley;,citation_author=Ammar Ahmad Awan;,citation_author=others;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_journal_title=arXiv preprint arXiv:2310.04610;">
<meta name="citation_reference" content="citation_title=Protein generation via genome-scale language models with bio-physical scoring;,citation_author=Gautham Dharuman;,citation_author=Logan Ward;,citation_author=Heng Ma;,citation_author=Priyanka V Setty;,citation_author=Ozan Gokdemir;,citation_author=Sam Foreman;,citation_author=Murali Emani;,citation_author=Kyle Hippe;,citation_author=Alexander Brace;,citation_author=Kristopher Keipert;,citation_author=others;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_conference_title=Proceedings of the SC‚Äô23 workshops of the international conference on high performance computing, network, storage, and analysis;">
<meta name="citation_reference" content="citation_title=MLMC: Machine learning monte carlo for lattice gauge theory;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C Osborn;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_journal_title=arXiv preprint arXiv:2312.08936;">
<meta name="citation_reference" content="citation_title=Snowmass 2021 computational frontier CompF03 topical group report: Machine learning;,citation_author=Phiala Shanahan;,citation_author=Kazuhiro Terao;,citation_author=Daniel Whiteson;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_journal_title=arXiv preprint arXiv:2209.07559;">
<meta name="citation_reference" content="citation_title=Thorough characterization and analysis of large transformer model training at-scale;,citation_author=Scott Cheng;,citation_author=Jun-Liang Lin;,citation_author=Murali Emani;,citation_author=Siddhisanket Raskar;,citation_author=Sam Foreman;,citation_author=Zhen Xie;,citation_author=Venkatram Vishwanath;,citation_author=Mahmut Taylan Kandemir;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_issue=1;,citation_volume=8;,citation_journal_title=Proceedings of the ACM on Measurement and Analysis of Computing Systems;,citation_publisher=ACM New York, NY, USA;">
<meta name="citation_reference" content="citation_title=Communities through energy justice projects;,citation_author=Mary Ann Leung;,citation_author=Katharine Cahill;,citation_author=Rebecca Hartman-Baker;,citation_author=Paige Kinsley;,citation_author=Lois Curfman McInnes;,citation_author=Suzanne Parete-Koon;,citation_author=Subil Abraham;,citation_author=Lacy Beach Barrier;,citation_author=Gladys Chen;,citation_author=Lizanne DeStefano;,citation_author=others;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_issue=1;,citation_volume=15;,citation_journal_title=Journal of Computational Science;">
<meta name="citation_reference" content="citation_title=Applications of a foundation model approach for weather and climate;,citation_author=Troy Arcomano;,citation_author=Alexander Wikner;,citation_author=Romit Maulik;,citation_author=Veerabhadra Rao Kotamarthi;,citation_author=Sam Foreman;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_volume=2023;,citation_conference_title=AGU fall meeting abstracts;">
<meta name="citation_reference" content="citation_title=Toward a holistic performance evaluation of large language models across diverse ai accelerators;,citation_author=Murali Emani;,citation_author=Sam Foreman;,citation_author=Varuni Sastry;,citation_author=Zhen Xie;,citation_author=Siddhisanket Raskar;,citation_author=William Arnold;,citation_author=Rajeev Thakur;,citation_author=Venkatram Vishwanath;,citation_author=Michael E Papka;,citation_author=Sanjif Shanmugavelu;,citation_author=others;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_conference_title=2024 IEEE international parallel and distributed processing symposium workshops (IPDPSW);,citation_conference=IEEE;">
<meta name="citation_reference" content="citation_title=Intro to HPC bootcamp: Engaging new communities through energy justice projects;,citation_author=Suzanne Parete-Koon;,citation_author=Michael Sandoval;,citation_author=Kellen Leland;,citation_author=Subil Abraham;,citation_author=Mary Ann Leung;,citation_author=Rebecca Hartman-Baker;,citation_author=Paige Kinsley;,citation_author=Lois McInnes;,citation_author=Sreeranjani Ramprakash;,citation_author=Lacy Beach Barrier;,citation_author=others;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_issue=1;,citation_volume=15;,citation_journal_title=Journal of Computational Science Education;,citation_publisher=Oak Ridge National Laboratory (ORNL), Oak Ridge, TN (United States);">
<meta name="citation_reference" content="citation_title=MProt-DPO: Breaking the ExaFLOPS barrier for multimodal protein design workflows with direct preference optimization;,citation_author=Gautham Dharuman;,citation_author=Kyle Hippe;,citation_author=Alexander Brace;,citation_author=Sam Foreman;,citation_author=V√§in√§ Hatanp√§√§;,citation_author=Varuni K Sastry;,citation_author=Huihuo Zheng;,citation_author=Logan Ward;,citation_author=Servesh Muralidharan;,citation_author=Archit Vasan;,citation_author=others;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_conference_title=2024 SC24: International conference for high performance computing, networking, storage and analysis SC;,citation_conference=IEEE Computer Society;">
<meta name="citation_reference" content="citation_title=Emergent abilities of large language models;,citation_author=Jason Wei;,citation_author=Yi Tay;,citation_author=Rishi Bommasani;,citation_author=Colin Raffel;,citation_author=Barret Zoph;,citation_author=Sebastian Borgeaud;,citation_author=Dani Yogatama;,citation_author=Maarten Bosma;,citation_author=Denny Zhou;,citation_author=Donald Metzler;,citation_author=Ed H. Chi;,citation_author=Tatsunori Hashimoto;,citation_author=Oriol Vinyals;,citation_author=Percy Liang;,citation_author=Jeff Dean;,citation_author=William Fedus;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2206.07682;">
<meta name="citation_reference" content="citation_title=DeepSpeed4Science initiative: Enabling large-scale scientific discovery through sophisticated AI system technologies;,citation_author=Shuaiwen Leon Song;,citation_author=Bonnie Kruft;,citation_author=Minjia Zhang;,citation_author=Conglong Li;,citation_author=Shiyang Chen;,citation_author=Chengming Zhang;,citation_author=Masahiro Tanaka;,citation_author=Xiaoxia Wu;,citation_author=Jeff Rasley;,citation_author=Ammar Ahmad Awan;,citation_author=Connor Holmes;,citation_author=Martin Cai;,citation_author=Adam Ghanem;,citation_author=Zhongzhu Zhou;,citation_author=Yuxiong He;,citation_author=Pete Luferenko;,citation_author=Divya Kumar;,citation_author=Jonathan Weyn;,citation_author=Ruixiong Zhang;,citation_author=Sylwester Klocek;,citation_author=Volodymyr Vragov;,citation_author=Mohammed AlQuraishi;,citation_author=Gustaf Ahdritz;,citation_author=Christina Floristean;,citation_author=Cristina Negri;,citation_author=Rao Kotamarthi;,citation_author=Venkatram Vishwanath;,citation_author=Arvind Ramanathan;,citation_author=Sam Foreman;,citation_author=Kyle Hippe;,citation_author=Troy Arcomano;,citation_author=Romit Maulik;,citation_author=Maxim Zvyagin;,citation_author=Alexander Brace;,citation_author=Bin Zhang;,citation_author=Cindy Orozco Bohorquez;,citation_author=Austin Clyde;,citation_author=Bharat Kale;,citation_author=Danilo Perez-Rivera;,citation_author=Heng Ma;,citation_author=Carla M. Mann;,citation_author=Michael Irvin;,citation_author=J. Gregory Pauloski;,citation_author=Logan Ward;,citation_author=Valerie Hayot;,citation_author=Murali Emani;,citation_author=Zhen Xie;,citation_author=Diangen Lin;,citation_author=Maulik Shukla;,citation_author=Ian Foster;,citation_author=James J. Davis;,citation_author=Michael E. Papka;,citation_author=Thomas Brettin;,citation_author=Prasanna Balaprakash;,citation_author=Gina Tourassi;,citation_author=John Gounley;,citation_author=Heidi Hanson;,citation_author=Thomas E Potok;,citation_author=Massimiliano Lupo Pasini;,citation_author=Kate Evans;,citation_author=Dan Lu;,citation_author=Dalton Lunga;,citation_author=Junqi Yin;,citation_author=Sajal Dash;,citation_author=Feiyi Wang;,citation_author=Mallikarjun Shankar;,citation_author=Isaac Lyngaas;,citation_author=Xiao Wang;,citation_author=Guojing Cong;,citation_author=Pei Zhang;,citation_author=Ming Fan;,citation_author=Siyan Liu;,citation_author=Adolfy Hoisie;,citation_author=Shinjae Yoo;,citation_author=Yihui Ren;,citation_author=William Tang;,citation_author=Kyle Felker;,citation_author=Alexey Svyatkovskiy;,citation_author=Hang Liu;,citation_author=Ashwin Aji;,citation_author=Angela Dalton;,citation_author=Michael Schulte;,citation_author=Karl Schulz;,citation_author=Yuntian Deng;,citation_author=Weili Nie;,citation_author=Josh Romero;,citation_author=Christian Dallago;,citation_author=Arash Vahdat;,citation_author=Chaowei Xiao;,citation_author=Thomas Gibbs;,citation_author=Anima Anandkumar;,citation_author=Rick Stevens;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2310.04610;">
<meta name="citation_reference" content="citation_title=Emergent abilities of large language models;,citation_author=Jason Wei;,citation_author=Yi Tay;,citation_author=Rishi Bommasani;,citation_author=Colin Raffel;,citation_author=Barret Zoph;,citation_author=Sebastian Borgeaud;,citation_author=Dani Yogatama;,citation_author=Maarten Bosma;,citation_author=Denny Zhou;,citation_author=Donald Metzler;,citation_author=Ed H. Chi;,citation_author=Tatsunori Hashimoto;,citation_author=Oriol Vinyals;,citation_author=Percy Liang;,citation_author=Jeff Dean;,citation_author=William Fedus;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2206.07682;">
<meta name="citation_reference" content="citation_title=The climate risk &amp;amp;amp; resilience portal (ClimRR) metadata and data dictionary;,citation_author=C. Burdi;,citation_author=Wall. T Branham;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://dub.sh/ClimRR-Metadata;">
<meta name="citation_reference" content="citation_title=Progress on $(g-2)_\mu$ from lattice QCD;,citation_author=Hartmut Wittig;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2306.04165;">
<meta name="citation_reference" content="citation_title=Hybrid Monte Carlo;,citation_author=S. Duane;,citation_author=A. D. Kennedy;,citation_author=B. J. Pendleton;,citation_author=D. Roweth;,citation_publication_date=1987;,citation_cover_date=1987;,citation_year=1987;,citation_doi=10.1016/0370-2693(87)91197-X;,citation_volume=195;,citation_journal_title=Phys. Lett. B;">
<meta name="citation_reference" content="citation_title=Snowmass 2021 Computational Frontier CompF03 Topical Group Report: Machine Learning;,citation_author=Phiala Shanahan;,citation_author=others;,citation_publication_date=2022-09;,citation_cover_date=2022-09;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2209.07559;">
<meta name="citation_reference" content="citation_title=Applications of Machine Learning to Lattice Quantum Field Theory;,citation_author=Denis Boyda;,citation_author=others;,citation_publication_date=2022-02;,citation_cover_date=2022-02;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2202.05838;,citation_conference_title=Snowmass 2021;">
<meta name="citation_reference" content="citation_title=HMC with Normalizing Flows;,citation_author=Sam Foreman;,citation_author=Taku Izubuchi;,citation_author=Luchang Jin;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_author=Akio Tomiya;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2112.01586;,citation_doi=10.22323/1.396.0073;,citation_volume=LATTICE2021;,citation_journal_title=PoS;">
<meta name="citation_reference" content="citation_title=LeapfrogLayers: A Trainable Framework for Effective Topological Sampling;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2112.01582;,citation_doi=10.22323/1.396.0508;,citation_volume=LATTICE2021;,citation_journal_title=PoS;">
<meta name="citation_reference" content="citation_title=Deep Learning Hamiltonian Monte Carlo;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_publication_date=2021-05;,citation_cover_date=2021-05;,citation_year=2021;,citation_fulltext_html_url=https://arxiv.org/abs/2105.03418;,citation_conference_title=9th International Conference on Learning Representations;">
<meta name="citation_reference" content="citation_title=Energy Justice Analysis of Climate Data with ClimRR;,citation_author=Sam Foreman;,citation_publication_date=2023-08-07;,citation_cover_date=2023-08-07;,citation_year=2023;,citation_fulltext_html_url=https://saforem2.github.io/climate-analysis;,citation_language=en;">
<meta name="citation_reference" content="citation_author=Sam Foreman;,citation_publication_date=2023-08-19;,citation_cover_date=2023-08-19;,citation_year=2023;,citation_fulltext_html_url=https://saforem2.github.io/l2hmc-qcd;,citation_language=en;">
<meta name="citation_reference" content="citation_title=Deep learning hamiltonian monte carlo;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://arxiv.org/abs/2105.03418;">
<meta name="citation_reference" content="citation_title=MLMC: Machine learning monte carlo for lattice gauge theory;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James Osborn;,citation_publication_date=00;,citation_cover_date=00;,citation_year=0;,citation_conference_title=40th international symposium on lattice field theory (lattice 2023) (batavia, IL, united states, 07/31/2023 - 08/04/2023);">
<meta name="citation_reference" content="citation_title=Progress on $(g-2)_\mu$ from lattice QCD;,citation_author=Hartmut Wittig;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2306.04165;">
<meta name="citation_reference" content="citation_title=Hybrid Monte Carlo;,citation_author=S. Duane;,citation_author=A. D. Kennedy;,citation_author=B. J. Pendleton;,citation_author=D. Roweth;,citation_publication_date=1987;,citation_cover_date=1987;,citation_year=1987;,citation_doi=10.1016/0370-2693(87)91197-X;,citation_volume=195;,citation_journal_title=Phys. Lett. B;">
<meta name="citation_reference" content="citation_title=Snowmass 2021 Computational Frontier CompF03 Topical Group Report: Machine Learning;,citation_author=Phiala Shanahan;,citation_author=others;,citation_publication_date=2022-09;,citation_cover_date=2022-09;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2209.07559;">
<meta name="citation_reference" content="citation_title=Applications of Machine Learning to Lattice Quantum Field Theory;,citation_author=Denis Boyda;,citation_author=others;,citation_publication_date=2022-02;,citation_cover_date=2022-02;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2202.05838;,citation_conference_title=Snowmass 2021;">
<meta name="citation_reference" content="citation_title=LeapfrogLayers: A Trainable Framework for Effective Topological Sampling;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_publication_date=2022-05;,citation_cover_date=2022-05;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2112.01582;,citation_doi=10.22323/1.396.0508;,citation_volume=LATTICE2021;,citation_journal_title=PoS;">
<meta name="citation_reference" content="citation_title=HMC with Normalizing Flows;,citation_author=Sam Foreman;,citation_author=Taku Izubuchi;,citation_author=Luchang Jin;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_author=Akio Tomiya;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2112.01586;,citation_doi=10.22323/1.396.0073;,citation_volume=LATTICE2021;,citation_journal_title=PoS;">
<meta name="citation_reference" content="citation_title=Deep Learning Hamiltonian Monte Carlo;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_publication_date=2021-05;,citation_cover_date=2021-05;,citation_year=2021;,citation_fulltext_html_url=https://arxiv.org/abs/2105.03418;,citation_conference_title=9th International Conference on Learning Representations;">
<meta name="citation_reference" content="citation_title=Mastering language models;,citation_author=Samuel Montgomery;,citation_publication_date=2023-10;,citation_cover_date=2023-10;,citation_year=2023;,citation_fulltext_html_url=https://towardsdatascience.com/mastering-language-models-32e1d891511a
           ;,citation_journal_title=Medium;,citation_publisher=Towards Data Science;">
<meta name="citation_reference" content="citation_title=Harnessing the power of LLMs in practice: A survey on ChatGPT and beyond;,citation_author=Jingfeng Yang;,citation_author=Hongye Jin;,citation_author=Ruixiang Tang;,citation_author=Xiaotian Han;,citation_author=Qizhang Feng;,citation_author=Haoming Jiang;,citation_author=Bing Yin;,citation_author=Xia Hu;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2304.13712;">
<meta name="citation_reference" content="citation_title=Training tips for the transformer model;,citation_author=Martin Popel;,citation_author=Ond≈ôej Bojar;,citation_publication_date=2018-04;,citation_cover_date=2018-04;,citation_year=2018;,citation_fulltext_html_url=https://doi.org/10.2478%2Fpralin-2018-0002;,citation_issue=1;,citation_doi=10.2478/pralin-2018-0002;,citation_volume=110;,citation_journal_title=The Prague Bulletin of Mathematical Linguistics;,citation_publisher=Charles University in Prague, Karolinum Press;">
<meta name="citation_reference" content="citation_title=Attention is all you need;,citation_author=Ashish Vaswani;,citation_author=Noam Shazeer;,citation_author=Niki Parmar;,citation_author=Jakob Uszkoreit;,citation_author=Llion Jones;,citation_author=Aidan N. Gomez;,citation_author=Lukasz Kaiser;,citation_author=Illia Polosukhin;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_fulltext_html_url=https://arxiv.org/abs/1706.03762;">
<meta name="citation_reference" content="citation_title=Tree of thoughts: Deliberate problem solving with large language models;,citation_author=Shunyu Yao;,citation_author=Dian Yu;,citation_author=Jeffrey Zhao;,citation_author=Izhak Shafran;,citation_author=Thomas L. Griffiths;,citation_author=Yuan Cao;,citation_author=Karthik Narasimhan;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2305.10601;">
<meta name="citation_reference" content="citation_title=GenSLMs: Genome-scale language models reveal SARS-CoV-2 evolutionary dynamics;,citation_abstract=We seek to transform how new and emergent variants of pandemiccausing viruses, specifically SARS-CoV-2, are identified and classified. By adapting large language models (LLMs) for genomic data, we build genome-scale language models (GenSLMs) which can learn the evolutionary landscape of SARS-CoV-2 genomes. By pretraining on over 110 million prokaryotic gene sequences and finetuning a SARS-CoV-2-specific model on 1.5 million genomes, we show that GenSLMs can accurately and rapidly identify variants of concern. Thus, to our knowledge, GenSLMs represents one of the first whole genome scale foundation models which can generalize to other prediction tasks. We demonstrate scaling of GenSLMs on GPU-based supercomputers and AI-hardware accelerators utilizing 1.63 Zettaflops in training runs with a sustained performance of 121 PFLOPS in mixed precision and peak of 850 PFLOPS. We present initial scientific insights from examining GenSLMs in tracking evolutionary dynamics of SARS-CoV-2, paving the path to realizing this on large biological data.Competing Interest StatementThe authors have declared no competing interest.;,citation_author=Maxim Zvyagin;,citation_author=Alexander Brace;,citation_author=Kyle Hippe;,citation_author=Yuntian Deng;,citation_author=Bin Zhang;,citation_author=Cindy Orozco Bohorquez;,citation_author=Austin Clyde;,citation_author=Bharat Kale;,citation_author=Danilo Perez-Rivera;,citation_author=Heng Ma;,citation_author=Carla M. Mann;,citation_author=Michael Irvin;,citation_author=J. Gregory Pauloski;,citation_author=Logan Ward;,citation_author=Valerie Hayot-Sasson;,citation_author=Murali Emani;,citation_author=Sam Foreman;,citation_author=Zhen Xie;,citation_author=Diangen Lin;,citation_author=Maulik Shukla;,citation_author=Weili Nie;,citation_author=Josh Romero;,citation_author=Christian Dallago;,citation_author=Arash Vahdat;,citation_author=Chaowei Xiao;,citation_author=Thomas Gibbs;,citation_author=Ian Foster;,citation_author=James J. Davis;,citation_author=Michael E. Papka;,citation_author=Thomas Brettin;,citation_author=Rick Stevens;,citation_author=Anima Anandkumar;,citation_author=Venkatram Vishwanath;,citation_author=Arvind Ramanathan;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://www.biorxiv.org/content/early/2022/11/23/2022.10.10.511571;,citation_doi=10.1101/2022.10.10.511571;,citation_journal_title=bioRxiv;,citation_publisher=Cold Spring Harbor Laboratory;">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/signature12.svg" alt="Sam Foreman" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-talks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">talks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-talks">    
        <li>
    <a class="dropdown-item" href="../../talks/index.html">
 <span class="dropdown-text">üì¢ All Talks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../talks/ai-for-science-2024/slides.html">
 <span class="dropdown-text">Parallel Training Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../talks/alcf-hpc-workshop-2024/slides.html">
 <span class="dropdown-text">AuroraGPT (ALCF Hands-On HPC)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../talks/alcf-hpc-workshop-2024/slides.html">
 <span class="dropdown-text">ML + Foundation Models at Scale</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../talks/hpc-user-forum/slides.html">
 <span class="dropdown-text">AuroraGPT (HPC User Forum)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../talks/llms-at-scale/slides.html">
 <span class="dropdown-text">Training LLMs at Scale</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../talks/llms-on-polaris/slides.html">
 <span class="dropdown-text">Polaris Overview + LLMs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/parallel-training-slides/">
 <span class="dropdown-text">Parallel Training Techniques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/llm-workshop-talk/">
 <span class="dropdown-text">LLMs from Scratch</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/LLM-tutorial">
 <span class="dropdown-text">Creating Small(-ish) LLMs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/oneapi-talk/#0">
 <span class="dropdown-text">Exascale Science on Aurora</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/llm-lunch-talk/">
 <span class="dropdown-text">LLM Lunch Talk</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/scaling4science">
 <span class="dropdown-text">Scaling LLMs for Science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/lattice23">
 <span class="dropdown-text">MLMC (for LQCD)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/lqcd-pasc23">
 <span class="dropdown-text">Generative Modeling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/deep-fridays">
 <span class="dropdown-text">Efficient Sampling for LGT</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/ai4sci-large-scale-training">
 <span class="dropdown-text">Large Scale Training</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/hparam-management-sdl2022">
 <span class="dropdown-text">Hyperparameter Management</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/ATPESC-StatisticalLearning">
 <span class="dropdown-text">Statistical Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/anl-job-talk/">
 <span class="dropdown-text">Scientific Data Science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/physicsSeminar">
 <span class="dropdown-text">Machine Learning in HEP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bit.ly/mainz21">
 <span class="dropdown-text">DLHMC for Improved Gauge Generation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://slides.com/samforeman/l2hmc-qcd-93bc0c">
 <span class="dropdown-text">ML for LQCD</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bit.ly/mainz21_overview">
 <span class="dropdown-text">ML Techniques in LQCD</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/physicsSeminar">
 <span class="dropdown-text">ML for HEP</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-posts" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">posts</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-posts">    
        <li>
    <a class="dropdown-item" href="../../posts/index.html">
 <span class="dropdown-text">üì¨ All Posts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/AuroraGPT/spike-skipper/index.html">
 <span class="dropdown-text">üèîÔ∏è Spike Skipper</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/ezpz-at-alcf/index.html">
 <span class="dropdown-text">üçã <code>ezpz</code> at ALCF</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/AuroraGPT/determinstic-flash-attn/index.html">
 <span class="dropdown-text">üé∞ Deterministic Flash Attention</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/AuroraGPT/flash-attn-sunspot/index.html">
 <span class="dropdown-text">üì∏ <code>flash-attn</code> on Sunspot</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/AuroraGPT/mpi4py-reproducer/index.html">
 <span class="dropdown-text">üêõ <code>mpi4py</code> bug on Sunspot</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/ai-for-physics/diffusion/index.html">
 <span class="dropdown-text">üé≤ MCMC + Diffusion Sampling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/dope-slides/index.html">
 <span class="dropdown-text">üíÖ How to Make Dope Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/AuroraGPT/startup-times/index.html">
 <span class="dropdown-text">‚è∞ Starting Up Distributed Training</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/AuroraGPT/long-sequences/index.html">
 <span class="dropdown-text">üöÇ Loooooooong Sequence Lengths</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/AuroraGPT/aurora-gpt/index.html">
 <span class="dropdown-text">üèéÔ∏è <code>Megatron-DeepSpeed</code> + Intel XPU</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/ai-for-physics/l2hmc-qcd/2dU1/index.html">
 <span class="dropdown-text">üé¢ <code>l2hmc-qcd</code> Example: 2D U(1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/ai-for-physics/l2hmc-qcd/4dSU3/index.html">
 <span class="dropdown-text">üî≥ <code>l2hmc-qcd</code> Example: 4D SU(3)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../../qmd/projects/index.html">
 <span class="dropdown-text">üìö All Projects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/ezpz">
 <span class="dropdown-text">üçã <code>ezpz</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/l2hmc-qcd">
 <span class="dropdown-text">üü• <code>l2hmc-qcd</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/argonne-lcf/Megatron-DeepSpeed)">
 <span class="dropdown-text">ü§ñ <code>Megatron-DeepSpeed</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/wordplay">
 <span class="dropdown-text">üí¨ <code>wordplay</code> üéÆ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.alcf.anl.gov/alcf-ai-science-training-series?">
 <span class="dropdown-text">üéì <code>ai-science-training</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/enrich">
 <span class="dropdown-text">üí∏ <code>enrich</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/ambivalent">
 <span class="dropdown-text">ü§∑üèª‚Äç‚ôÇÔ∏è<code>ambivalent</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://saforem2.github.io/climate-analysis">
 <span class="dropdown-text">üåç <code>climate-analysis</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/saforem2/glitz">
 <span class="dropdown-text">üé® <code>glitz</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/saforem2/personal_site">
 <span class="dropdown-text">üôãüèª<code>personal_site</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/saforem2/notes-demo">
 <span class="dropdown-text">üóíÔ∏è <code>Notes-Demo</code></span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/saforem2/personal_site"> 
<span class="menu-text"><span class="icon dim-text" style="font-size: 1.25rem;"><iconify-icon role="img" inline="" icon="ph:github-logo" aria-label="Icon github-logo from ph Iconify.design set." title="Icon github-logo from ph Iconify.design set."></iconify-icon></span></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.xml"> 
<span class="menu-text"><span class="icon dim-text" style="font-size: 1.25rem;"><iconify-icon role="img" inline="" icon="ph:rss" aria-label="Icon rss from ph Iconify.design set." title="Icon rss from ph Iconify.design set."></iconify-icon></span></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link active" data-scroll-target="#getting-started">üê£ Getting Started</a></li>
  <li><a href="#shell-utilities" id="toc-shell-utilities" class="nav-link" data-scroll-target="#shell-utilities">üêö Shell Utilities</a>
  <ul class="collapse">
  <li><a href="#setup-environment" id="toc-setup-environment" class="nav-link" data-scroll-target="#setup-environment">‚öôÔ∏è Setup Environment</a></li>
  </ul></li>
  <li><a href="#python-library" id="toc-python-library" class="nav-link" data-scroll-target="#python-library">üêç Python Library</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/saforem2/personal_site/blob/main/posts/ezpz-at-alcf/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/saforem2/personal_site/edit/main/posts/ezpz-at-alcf/index.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/saforem2/personal_site/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TC329HJ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">üçã <code>ezpz</code> @ ALCF</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">ezpz</div>
    <div class="quarto-category">ML</div>
    <div class="quarto-category">ai4science</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://samforeman.me">Sam Foreman</a> <a href="mailto:foremans@anl.gov" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://alcf.anl.gov/about/people/sam-foreman">
            </a><a href="https://alcf.anl.gov/about/people/sam-foreman">ALCF</a>
            
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 23, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 25, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<blockquote class="blockquote">
<p><em>Work smarter, not harder</em>.</p>
</blockquote>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">üê£ Getting Started</h2>
<p>There are two main, distinct components of <code>ezpz</code>:</p>
<ol type="1">
<li>üêç <a href="#python-library"><strong>Python Library</strong></a></li>
<li>üêö <a href="#shell-utilities"><strong>Shell Utilities</strong></a></li>
</ol>
</section>
<section id="shell-utilities" class="level2">
<h2 class="anchored" data-anchor-id="shell-utilities">üêö Shell Utilities</h2>
<p>The Shell Utilities can be roughly broken up further into two main components</p>
<ol type="1">
<li><a href="#setup-environment">Setup Environment</a>:</li>
<li><a href="#setup-python">Setup Python</a>:
<ol type="1">
<li><a href="#setup-conda">Setup Conda</a></li>
<li><a href="#setup-virtual-environment">Setup Virtual Environment</a></li>
</ol></li>
<li><a href="#setup-job">Setup Job</a>:</li>
</ol>
<p>We provide a variety of helper functions designed to make your life easier when working with job schedulers (e.g.&nbsp;<code>PBS Pro</code> @ ALCF or <code>slurm</code> elsewhere).</p>
<p><strong>All</strong> of these functions are:</p>
<ul>
<li>located in <a href="../../src/ezpz/bin/utils.sh"><code>utils.sh</code></a></li>
<li>prefixed with <code>ezpz_*</code> (e.g.&nbsp;<code>ezpz_setup_python</code>)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
</ul>
<p>To use these, we can <code>source</code> the file directly via:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="bu">export</span> <span class="va">PBS_O_WORKDIR</span><span class="op">=</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span> <span class="co"># if on ALCF</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="bu">source</span> /dev/stdin <span class="op">&lt;&lt;&lt;</span> <span class="va">$(</span><span class="ex">curl</span> <span class="st">'https://raw.githubusercontent.com/saforem2/ezpz/refs/heads/main/src/ezpz/bin/utils.sh'</span><span class="va">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="setup-environment" class="level3">
<h3 class="anchored" data-anchor-id="setup-environment">‚öôÔ∏è Setup Environment</h3>
<p>We would like to write our application in such a way that it is able to take full advantage of the resources allocated by the job scheduler.</p>
<p>That is to say, we want to have a single script with the ability to dynamically <code>launch</code> python applications across any number of accelerators on any of the systems under consideration.</p>
<p>In order to do this, there is some basic setup and information gathering that needs to occur.</p>
<p>In particular, we need mechanisms for:</p>
<ol type="1">
<li>Setting up a python environment</li>
<li>Determining what system / machine we‚Äôre on
<ul>
<li>+ what job scheduler we‚Äôre using (e.g.&nbsp;<code>PBS Pro</code> @ ALCF or <code>slurm</code> elsewhere)</li>
</ul></li>
<li>Determining how many nodes have been allocated in the current job (<code>NHOSTS</code>)
<ul>
<li>+ Determining how many accelerators exist on each of these nodes (<code>NGPU_PER_HOST</code>)</li>
</ul></li>
</ol>
<p>This allows us to calculate the total number of accelerators (GPUs) as: <span class="math inline">N_{\mathrm{GPU}} = N_{\mathrm{HOST}} \times n_{\mathrm{GPU}}</span></p>
<p>where <span class="math inline">n_{\mathrm{GPU}} = N_{\mathrm{GPU}} / N_{\mathrm{HOST}}</span> is the number of GPUs per host.</p>
<p>With this we have everything we need to build the appropriate {<code>mpi</code>{<code>run</code>, <code>exec</code>}, <code>slurm</code>} command for launching our python application across them.</p>
<p>Now, there are a few functions in particular worth elaborating on.</p>
<div id="tbl-shell-fns" class="responsive striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-shell-fns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="table-responsive">
<table class="table-striped table-hover table">
<thead>
<tr class="header">
<th style="text-align: left;">&nbsp;</th>
<th style="text-align: left;">Function</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><a href="#setup-environment">Setup Environment</a></td>
<td style="text-align: left;"><code>ezpz_setup_env</code></td>
<td style="text-align: left;">Wrapper around <code>ezpz_setup_python &amp;&amp; ezpz_setup_job</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#setup-job">Setup Job</a></td>
<td style="text-align: left;"><code>ezpz_setup_job</code></td>
<td style="text-align: left;">Determine {<code>NGPUS</code>, <code>NGPU_PER_HOST</code>, <code>NHOSTS</code>}, build <code>launch</code> command alias</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="#setup-python">Setup Python</a></td>
<td style="text-align: left;"><code>ezpz_setup_python</code></td>
<td style="text-align: left;">Load python modules and activate virtual environment</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#setup-conda">Setup Conda</a></td>
<td style="text-align: left;"><code>ezpz_setup_conda</code></td>
<td style="text-align: left;">Identify appropriate <code>conda</code> module to load</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="#setup-virtual-environment">Setup Virtual Environment</a></td>
<td style="text-align: left;"><code>ezpz_setup_venv_from_conda</code></td>
<td style="text-align: left;">From <code>${CONDA_NAME}</code>, build or activate the virtual env located in <code>venvs/${CONDA_NAME}/</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-shell-fns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Shell Functions
</figcaption>
</figure>
</div>
<p> </p>
<div class="callout callout-style-simple callout-warning callout-titled" title="Where am I?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Where am I?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><em>Some</em> of the <code>ezpz_*</code> functions (e.g.&nbsp;<code>ezpz_setup_python</code>), will try to create / look for certain directories.</p>
<p>In an effort to be explicit, these directories will be defined <strong>relative to</strong> a <code>WORKING_DIR</code> (e.g.&nbsp;<code>"${WORKING_DIR}/venvs/"</code>)</p>
<p>This <code>WORKING_DIR</code> will be assigned to the first non-zero match found below:</p>
<ol type="1">
<li><code>PBS_O_WORKDIR</code>: If found in environment, paths will be relative to this</li>
<li><code>SLURM_SUBMIT_DIR</code>: Next in line. If not @ ALCF, maybe using <code>slurm</code>‚Ä¶</li>
<li><code>$(pwd)</code>: Otherwise, no worries. Use your <em>actual</em> working directory.</li>
</ol>
</div>
</div>
</div>
<section id="setup-python" class="level4">
<h4 class="anchored" data-anchor-id="setup-python">üõ†Ô∏è Setup Python</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="ex">ezpz_setup_python</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will:</p>
<ol type="1">
<li><p>Automatically load and activate <code>conda</code> using the <code>ezpz_setup_conda</code> function.</p>
<p>How this is done, in practice, varies from machine to machine:</p>
<ul>
<li><p><strong>ALCF</strong><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>: Automatically load the most recent <code>conda</code> module and activate the base environment.</p></li>
<li><p><strong>Frontier</strong>: Load the appropriate AMD modules (e.g.&nbsp;<code>rocm</code>, <code>RCCL</code>, etc.), and activate base <code>conda</code></p></li>
<li><p><strong>Perlmutter</strong>: Load the appropriate <code>pytorch</code> module and activate environment</p></li>
<li><p><strong>Unknown</strong>: In this case, we will look for a <code>conda</code>, <code>mamba</code>, or <code>micromamba</code> executable, and if found, use that to activate the base environment.</p></li>
</ul>
<div class="callout callout-style-simple callout-tip callout-titled" title="Using your own `conda`">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Using your own <code>conda</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are already in a conda environment when calling <code>ezpz_setup_python</code> then it will try and use this instead.</p>
<p>For example, if you have a custom <code>conda</code> env at <code>~/conda/envs/custom</code>, then this would bootstrap the <code>custom</code> conda environment and create the virtual env in <code>venvs/custom/</code></p>
</div>
</div></li>
<li><p>Build (or activate, if found) a virtual environment on top of (the active) base <code>conda</code> environment.</p>
<p>By default, it will try looking in:</p>
<ul>
<li><code>$PBS_O_WORKDIR</code>, otherwise</li>
<li><code>${SLURM_SUBMIT_DIR}</code>, otherwise</li>
<li><code>$(pwd)</code></li>
</ul>
<p>for a nested folder named <code>"venvs/${CONDA_NAME}"</code>.</p>
<p>If this doesn‚Äôt exist, it will attempt to create a new virtual environment at this location using:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="ex">python3</span> <span class="at">-m</span> venv venvs/<span class="va">${CONDA_NAME}</span> <span class="at">--system-site-packages</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(where we‚Äôve pulled in the <code>--system-site-packages</code> from conda).</p></li>
</ol>
</section>
<section id="setup-job" class="level4">
<h4 class="anchored" data-anchor-id="setup-job">üß∞ Setup Job</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="ex">ezpz_setup_job</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that we are in a suitable python environment, we need to construct the command that we will use to run python on each of our acceleratorss.</p>
<p>To do this, we need a few things:</p>
<ol type="1">
<li>What machine we‚Äôre on (and what scheduler is it using i.e.&nbsp;{PBS, SLURM})</li>
<li>How many nodes are available in our active job</li>
<li>How many GPUs are on each of those nodes</li>
<li>What type of GPUs are they</li>
</ol>
<p>With this information, we can then use <code>mpi{exec,run}</code> or <code>srun</code> to launch python across all of our accelerators.</p>
<p>Again, how this is done will vary from machine to machine and will depend on the job scheduler in use.</p>
<p>To identify where we are, we look at our <code>$(hostname)</code> and see if we‚Äôre running on one of the known machines:</p>
<ul>
<li><strong>ALCF</strong><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>: Using PBS Pro via <code>qsub</code> and <code>mpiexec</code> / <code>mpirun</code>.
<ul>
<li><code>x4*</code>: <strong>Aurora</strong></li>
<li><strong>Aurora</strong>: <code>x4*</code> (or <code>aurora*</code> on login nodes)</li>
<li><strong>Sunspot</strong>: <code>x1*</code> (or <code>uan*</code>)</li>
<li><strong>Sophia</strong>: <code>sophia-*</code></li>
<li><strong>Polaris</strong> / <strong>Sirius</strong>: <code>x3*</code>
<ul>
<li>to determine between the two, we look at <code>"${PBS_O_HOST}"</code></li>
</ul></li>
</ul></li>
</ul>
<ul>
<li><p><strong>OLCF</strong>: Using Slurm via <code>sbatch</code> / <code>srun</code>.</p>
<ul>
<li><code>frontier*</code>: <strong>Frontier</strong>, using Slurm</li>
<li><code>nid*</code>: Perlmutter, using Slurm</li>
</ul></li>
<li><p>Unknown machine: If <code>$(hostname)</code> does not match one of these patterns we assume that we are running on an unknown machine and will try to use <code>mpirun</code> as our generic launch command</p>
<p>Once we have this, we can:</p>
<ol type="1">
<li><p>Get <code>PBS_NODEFILE</code> from <code>$(hostname)</code>:</p>
<ul>
<li><p><code>ezpz_qsme_running</code>: For each (running) job owned by <code>${USER}</code>, print out both the jobid as well as a list of hosts the job is running on, e.g.:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="op">&lt;</span>jobid0<span class="op">&gt;</span> host00 <span class="ex">host01</span> host02 host03 ...</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="op">&lt;</span>jobid1<span class="op">&gt;</span> host10 <span class="ex">host11</span> host12 host13 ...</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="ex">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>ezpz_get_pbs_nodefile_from_hostname</code>: Look for <code>$(hostname)</code> in the output from the above command to determine our <code>${PBS_JOBID}</code>.</p>
<p>Once we‚Äôve identified our <code>${PBS_JOBID}</code> we then know the location of our <code>${PBS_NODEFILE}</code> since they are named according to:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="va">jobid</span><span class="op">=</span><span class="va">$(</span><span class="ex">ezpz_qsme_running</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"</span><span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'{print $1}'</span><span class="va">)</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="va">prefix</span><span class="op">=</span>/var/spool/pbs/aux</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="va">match</span><span class="op">=</span><span class="va">$(</span><span class="ex">/bin/ls</span> <span class="st">"</span><span class="va">${prefix}</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"</span><span class="va">${jobid}</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="va">hostfile</span><span class="op">=</span><span class="st">"</span><span class="va">${prefix}</span><span class="st">/</span><span class="va">${match}</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p>Identify number of available accelerators:</p></li>
</ol></li>
</ul>
</section>
</section>
</section>
<section id="python-library" class="level2">
<h2 class="anchored" data-anchor-id="python-library">üêç Python Library</h2>
<p>To install<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a><span class="ex">python3</span> <span class="at">-m</span> pip install <span class="at">-e</span> <span class="st">"git+https://github.com/saforem2/ezpz#egg=ezpz"</span> <span class="at">--require-virtualenv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>üìÇ <a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/bin/"><code>bin/</code></a>:
<ul>
<li><a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/bin/utils.sh"><code>ezpz/bin/utils.sh</code></a>: Common utilities for EZPZ</li>
</ul></li>
<li>üìÇ <a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/conf/"><code>conf/</code></a>:
<ul>
<li>‚öôÔ∏è <a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/conf/config.yaml"><code>conf/config.yaml</code></a>: Default <code>TrainConfig</code> object</li>
<li>‚öôÔ∏è <a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/conf/ds_config.json"><code>conf/ds_config.json</code></a>: DeepSpeed configuration</li>
</ul></li>
<li>üìÇ <a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/log/"><code>log/</code></a>: Logging configuration.</li>
<li>üêç <a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/__about__.py"><code>__about__.py</code></a>: Version information</li>
<li>üêç <a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/__init__.py"><code>__init__.py</code></a>: Main module</li>
<li>üêç <a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/__main__.py"><code>__main__.py</code></a>: Entry point</li>
<li>üêç <a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/configs.py"><code>configs.py</code></a>: Configuration module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/create.py"><code>cria.py</code></a>: Baby Llama</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/dist.py"><strong><code>dist.py</code></strong></a>: Distributed training module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/history.py"><em><code>history.py</code></em></a>: History module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/jobs.py"><code>jobs.py</code></a>: Jobs module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/model.py"><code>model.py</code></a>: Model module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/plot.py"><code>plot.py</code></a>: Plot modul</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/profile.py"><code>profile.py</code></a>: Profile module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/runtime.py"><code>runtime.py</code></a>: Runtime module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/test.py"><code>test.py</code></a>: Test module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/test_dist.py"><strong><code>test_dist.py</code></strong></a>: Distributed training test module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/train.py"><code>train.py</code></a>: train module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/trainer.py"><code>trainer.py</code></a>: trainer module</li>
<li>üêç<a href="https://github.com/saforem2/ezpz/blob/main/src/ezpz/utils.py"><code>utils.py</code></a>: utility module</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="ex">üìÇ</span> /ezpz/src/ezpz/</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üìÇ bin/</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ affinity.sh</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ getjobenv</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ savejobenv</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ saveslurmenv</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ setup.sh</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ train.sh</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="ex">‚îÉ</span>   ‚îó‚îÅ‚îÅ üìÑ utils.sh</span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üìÇ conf/</span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÇ hydra/</span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="ex">‚îÉ</span>   ‚îÉ   ‚îó‚îÅ‚îÅ üìÇ job_logging/</span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="ex">‚îÉ</span>   ‚îÉ       ‚î£‚îÅ‚îÅ ‚öôÔ∏è colorlog1.yaml</span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="ex">‚îÉ</span>   ‚îÉ       ‚î£‚îÅ‚îÅ ‚öôÔ∏è custom.yaml</span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="ex">‚îÉ</span>   ‚îÉ       ‚îó‚îÅ‚îÅ ‚öôÔ∏è enrich.yaml</span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÇ logdir/</span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="ex">‚îÉ</span>   ‚îÉ   ‚îó‚îÅ‚îÅ ‚öôÔ∏è default.yaml</span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ ‚öôÔ∏è config.yaml</span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ ds_config.json</span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="ex">‚îÉ</span>   ‚îó‚îÅ‚îÅ ‚öôÔ∏è ds_config.yaml</span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üìÇ log/</span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÇ conf/</span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="ex">‚îÉ</span>   ‚îÉ   ‚îó‚îÅ‚îÅ üìÇ hydra/</span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="ex">‚îÉ</span>   ‚îÉ       ‚îó‚îÅ‚îÅ üìÇ job_logging/</span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="ex">‚îÉ</span>   ‚îÉ           ‚îó‚îÅ‚îÅ ‚öôÔ∏è enrich.yaml</span>
<span id="cb9-26"><a href="#cb9-26"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç __init__.py</span>
<span id="cb9-27"><a href="#cb9-27"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç __main__.py</span>
<span id="cb9-28"><a href="#cb9-28"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç config.py</span>
<span id="cb9-29"><a href="#cb9-29"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç console.py</span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç handler.py</span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç style.py</span>
<span id="cb9-32"><a href="#cb9-32"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç test.py</span>
<span id="cb9-33"><a href="#cb9-33"></a><span class="ex">‚îÉ</span>   ‚îó‚îÅ‚îÅ üêç test_log.py</span>
<span id="cb9-34"><a href="#cb9-34"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç __about__.py</span>
<span id="cb9-35"><a href="#cb9-35"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç __init__.py</span>
<span id="cb9-36"><a href="#cb9-36"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç __main__.py</span>
<span id="cb9-37"><a href="#cb9-37"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç configs.py</span>
<span id="cb9-38"><a href="#cb9-38"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç cria.py</span>
<span id="cb9-39"><a href="#cb9-39"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç dist.py</span>
<span id="cb9-40"><a href="#cb9-40"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç history.py</span>
<span id="cb9-41"><a href="#cb9-41"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç jobs.py</span>
<span id="cb9-42"><a href="#cb9-42"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç loadjobenv.py</span>
<span id="cb9-43"><a href="#cb9-43"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç model.py</span>
<span id="cb9-44"><a href="#cb9-44"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç plot.py</span>
<span id="cb9-45"><a href="#cb9-45"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç profile.py</span>
<span id="cb9-46"><a href="#cb9-46"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç runtime.py</span>
<span id="cb9-47"><a href="#cb9-47"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç savejobenv.py</span>
<span id="cb9-48"><a href="#cb9-48"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç test.py</span>
<span id="cb9-49"><a href="#cb9-49"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç test_dist.py</span>
<span id="cb9-50"><a href="#cb9-50"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç train.py</span>
<span id="cb9-51"><a href="#cb9-51"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç trainer.py</span>
<span id="cb9-52"><a href="#cb9-52"></a><span class="ex">‚îó‚îÅ‚îÅ</span> üêç utils.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p> </p>
<p> </p>



</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Plus this is useful for tab-completions in your shell, e.g.:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">$</span> ezpz_<span class="op">&lt;</span>TAB<span class="op">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="ex">ezpz_check_and_kill_if_running</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="ex">ezpz_get_dist_launch_cmd</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="ex">ezpz_get_job_env</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="ex">--More--</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></li>
<li id="fn2"><p>Any of {Aurora, Polaris, Sophia, Sunspot, Sirius}<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn3"><p>At ALCF, if our <code>$(hostname)</code> starts with <code>x*</code>, we‚Äôre on a compute node.<a href="#fnref3" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn4"><p>Note the <code>--require-virtualenv</code> isn‚Äôt <em>strictly</em> required, but I highly recommend to always try and work within a virtual environment, when possible.<a href="#fnref4" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@article{foreman2024,
  author = {Foreman, Sam},
  title = {üçã Ezpz at {ALCF}},
  date = {2024-08-23},
  url = {https://samforeman.me/posts/ezpz-at-alcf},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-foreman2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Foreman, Sam. 2024. <span>‚Äúüçã Ezpz at ALCF,‚Äù</span> August. <a href="https://samforeman.me/posts/ezpz-at-alcf">https://samforeman.me/posts/ezpz-at-alcf</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/samforeman\.me");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="an">title:</span><span class="co"> "üçã &lt;code&gt;ezpz&lt;/code&gt; @ ALCF"</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="an">categories:</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">  - ezpz</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">  - ML</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">  - ai4science</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="an">date:</span><span class="co"> 2024-08-23</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="an">date-modified:</span><span class="co"> last-modified</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="an">lightbox:</span><span class="co"> auto</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="an">tbl-cap-location:</span><span class="co"> bottom</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="an">citation:</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">   author: Sam Foreman</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">   type: article-journal</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">   title: "üçã ezpz at ALCF"</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">   url: https://samforeman.me/posts/ezpz-at-alcf</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="an">open-graph:</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">  title: "üçã ezpz @ ALCF"</span></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="co">  description: "üçã `ezpz` at ALCF"</span></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="co">  image: "./assets/thumbnail.png"</span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="an">twitter-card:</span></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co">  site: "saforem2"</span></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co">  creator: "saforem2"</span></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="co">  title: "üçã ezpz @ ALCF"</span></span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="co">  image: "./assets/thumbnail.png"</span></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co">  description: "üçã `ezpz` at ALCF"</span></span>
<span id="cb10-27"><a href="#cb10-27"></a><span class="co">  issued: 2022-10-01</span></span>
<span id="cb10-28"><a href="#cb10-28"></a><span class="an">format:</span></span>
<span id="cb10-29"><a href="#cb10-29"></a><span class="co">  html: default</span></span>
<span id="cb10-30"><a href="#cb10-30"></a><span class="co">  # gfm: default</span></span>
<span id="cb10-31"><a href="#cb10-31"></a></span>
<span id="cb10-32"><a href="#cb10-32"></a><span class="co"># csl: iso690-numeric-en.csl</span></span>
<span id="cb10-33"><a href="#cb10-33"></a><span class="co"># code-tools: true</span></span>
<span id="cb10-34"><a href="#cb10-34"></a><span class="co"># filters:</span></span>
<span id="cb10-35"><a href="#cb10-35"></a><span class="co">#   - collapse-social-embeds</span></span>
<span id="cb10-36"><a href="#cb10-36"></a><span class="co"># format:</span></span>
<span id="cb10-37"><a href="#cb10-37"></a><span class="co">#   # gfm:</span></span>
<span id="cb10-38"><a href="#cb10-38"></a><span class="co">#   #   output_file: "ezpz-at-alcf.md"</span></span>
<span id="cb10-39"><a href="#cb10-39"></a><span class="co">#   html: default</span></span>
<span id="cb10-40"><a href="#cb10-40"></a><span class="co">#   # revealjs:</span></span>
<span id="cb10-41"><a href="#cb10-41"></a><span class="co">#   #   slide-url: https://samforeman.me/posts/ezpz-at-alcf/slides.html</span></span>
<span id="cb10-42"><a href="#cb10-42"></a></span>
<span id="cb10-43"><a href="#cb10-43"></a><span class="co">  # revealjs:</span></span>
<span id="cb10-44"><a href="#cb10-44"></a><span class="co">  #   width: 1024</span></span>
<span id="cb10-45"><a href="#cb10-45"></a><span class="co">  #   height: 768</span></span>
<span id="cb10-46"><a href="#cb10-46"></a><span class="co">  #   max-scale: 4.0</span></span>
<span id="cb10-47"><a href="#cb10-47"></a><span class="co">  #   min-scale: 0.1</span></span>
<span id="cb10-48"><a href="#cb10-48"></a><span class="co">  #   # title: "AuroraGPT"</span></span>
<span id="cb10-49"><a href="#cb10-49"></a><span class="co">  #   pdf-separate-fragments: true</span></span>
<span id="cb10-50"><a href="#cb10-50"></a><span class="co">  #   center: false</span></span>
<span id="cb10-51"><a href="#cb10-51"></a><span class="co">  #   footer: "[samforeman.me/talks/AuroraGPT/alcf-hpc-workshop-2024/slides](https://samforeman.me/talks/AuroraGPT/alcf-hpc-workshop-2024/slides)"</span></span>
<span id="cb10-52"><a href="#cb10-52"></a><span class="co">  #   slide-url: https://samforeman.me/talks/AuroraGPT/alcf-hpc-workshop-2024/slides.html</span></span>
<span id="cb10-53"><a href="#cb10-53"></a><span class="co">  #   template-partials:</span></span>
<span id="cb10-54"><a href="#cb10-54"></a><span class="co">  #     - title-slide.html</span></span>
<span id="cb10-55"><a href="#cb10-55"></a><span class="co">  #   title-slide-attributes:</span></span>
<span id="cb10-56"><a href="#cb10-56"></a><span class="co">  #     # data-background-iframe: "file:///iframes/center-of-universe/index.html"</span></span>
<span id="cb10-57"><a href="#cb10-57"></a><span class="co">  #     # data-background-image: "https://raw.githubusercontent.com/saforem3/llm-lunch-talk/refs/heads/main/docs/assets/image2.png"</span></span>
<span id="cb10-58"><a href="#cb10-58"></a><span class="co">  #     data-background-size: cover</span></span>
<span id="cb10-59"><a href="#cb10-59"></a><span class="co">  #     data-background-iframe: https://emilhvitfeldt.github.io/quarto-iframe-examples/stars/index.html</span></span>
<span id="cb10-60"><a href="#cb10-60"></a><span class="co">  #     # background-color: dark</span></span>
<span id="cb10-61"><a href="#cb10-61"></a><span class="co">  #     # data-background-color: dark</span></span>
<span id="cb10-62"><a href="#cb10-62"></a><span class="co">  #   # shift-heading-level-by: -1</span></span>
<span id="cb10-63"><a href="#cb10-63"></a><span class="co"># twitter-card:                      </span></span>
<span id="cb10-64"><a href="#cb10-64"></a><span class="co">#     image: "./assets/thumbnail.png"</span></span>
<span id="cb10-65"><a href="#cb10-65"></a><span class="co">#     creator: "@saforem2"           </span></span>
<span id="cb10-66"><a href="#cb10-66"></a><span class="co">#     site: "@saforem2"              </span></span>
<span id="cb10-67"><a href="#cb10-67"></a><span class="co"># open-graph:                        </span></span>
<span id="cb10-68"><a href="#cb10-68"></a><span class="co">#     image: "./assets/thumbnail.png"</span></span>
<span id="cb10-69"><a href="#cb10-69"></a><span class="co">---</span></span>
<span id="cb10-70"><a href="#cb10-70"></a></span>
<span id="cb10-71"><a href="#cb10-71"></a><span class="at">&gt; _Work smarter, not harder_.</span></span>
<span id="cb10-72"><a href="#cb10-72"></a></span>
<span id="cb10-73"><a href="#cb10-73"></a><span class="fu">## üê£ Getting Started</span></span>
<span id="cb10-74"><a href="#cb10-74"></a></span>
<span id="cb10-75"><a href="#cb10-75"></a>There are two main, distinct components of <span class="in">`ezpz`</span>:</span>
<span id="cb10-76"><a href="#cb10-76"></a></span>
<span id="cb10-77"><a href="#cb10-77"></a><span class="ss">1. </span>üêç <span class="co">[</span><span class="ot">**Python Library**</span><span class="co">](#python-library)</span></span>
<span id="cb10-78"><a href="#cb10-78"></a><span class="ss">1. </span>üêö <span class="co">[</span><span class="ot">**Shell Utilities**</span><span class="co">](#shell-utilities)</span></span>
<span id="cb10-79"><a href="#cb10-79"></a></span>
<span id="cb10-80"><a href="#cb10-80"></a><span class="fu">## üêö Shell Utilities</span></span>
<span id="cb10-81"><a href="#cb10-81"></a></span>
<span id="cb10-82"><a href="#cb10-82"></a>The Shell Utilities can be roughly broken up further into two main components</span>
<span id="cb10-83"><a href="#cb10-83"></a></span>
<span id="cb10-84"><a href="#cb10-84"></a><span class="ss">1. </span><span class="co">[</span><span class="ot">Setup Environment</span><span class="co">](#setup-environment)</span>:</span>
<span id="cb10-85"><a href="#cb10-85"></a><span class="ss">  1. </span><span class="co">[</span><span class="ot">Setup Python</span><span class="co">](#setup-python)</span>:</span>
<span id="cb10-86"><a href="#cb10-86"></a><span class="ss">      1. </span><span class="co">[</span><span class="ot">Setup Conda</span><span class="co">](#setup-conda)</span></span>
<span id="cb10-87"><a href="#cb10-87"></a><span class="ss">      1. </span><span class="co">[</span><span class="ot">Setup Virtual Environment</span><span class="co">](#setup-virtual-environment)</span></span>
<span id="cb10-88"><a href="#cb10-88"></a><span class="ss">  1. </span><span class="co">[</span><span class="ot">Setup Job</span><span class="co">](#setup-job)</span>:</span>
<span id="cb10-89"><a href="#cb10-89"></a></span>
<span id="cb10-90"><a href="#cb10-90"></a></span>
<span id="cb10-91"><a href="#cb10-91"></a>We provide a variety of helper functions designed to make your life easier</span>
<span id="cb10-92"><a href="#cb10-92"></a>when working with job schedulers (e.g. <span class="in">`PBS Pro`</span> @ ALCF or <span class="in">`slurm`</span> elsewhere).</span>
<span id="cb10-93"><a href="#cb10-93"></a></span>
<span id="cb10-94"><a href="#cb10-94"></a>**All** of these functions are:</span>
<span id="cb10-95"><a href="#cb10-95"></a></span>
<span id="cb10-96"><a href="#cb10-96"></a><span class="ss">- </span>located in <span class="co">[</span><span class="ot">`utils.sh`</span><span class="co">](/src/ezpz/bin/utils.sh)</span></span>
<span id="cb10-97"><a href="#cb10-97"></a><span class="ss">- </span>prefixed with <span class="in">`ezpz_*`</span> (e.g. <span class="in">`ezpz_setup_python`</span>)<span class="ot">[^completions]</span></span>
<span id="cb10-98"><a href="#cb10-98"></a></span>
<span id="cb10-99"><a href="#cb10-99"></a>To use these, we can <span class="in">`source`</span> the file directly via:</span>
<span id="cb10-100"><a href="#cb10-100"></a></span>
<span id="cb10-101"><a href="#cb10-101"></a><span class="in">```bash</span></span>
<span id="cb10-102"><a href="#cb10-102"></a><span class="bu">export</span> <span class="va">PBS_O_WORKDIR</span><span class="op">=</span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span> <span class="co"># if on ALCF</span></span>
<span id="cb10-103"><a href="#cb10-103"></a><span class="bu">source</span> /dev/stdin <span class="op">&lt;&lt;&lt;</span> <span class="va">$(</span><span class="ex">curl</span> <span class="st">'https://raw.githubusercontent.com/saforem2/ezpz/refs/heads/main/src/ezpz/bin/utils.sh'</span><span class="va">)</span></span>
<span id="cb10-104"><a href="#cb10-104"></a><span class="in">```</span></span>
<span id="cb10-105"><a href="#cb10-105"></a></span>
<span id="cb10-106"><a href="#cb10-106"></a><span class="fu">### ‚öôÔ∏è Setup Environment</span></span>
<span id="cb10-107"><a href="#cb10-107"></a></span>
<span id="cb10-108"><a href="#cb10-108"></a>We would like to write our application in such a way that it is able to take</span>
<span id="cb10-109"><a href="#cb10-109"></a>full advantage of the resources allocated by the job scheduler.</span>
<span id="cb10-110"><a href="#cb10-110"></a></span>
<span id="cb10-111"><a href="#cb10-111"></a>That is to say, we want to have a single script with the ability to dynamically</span>
<span id="cb10-112"><a href="#cb10-112"></a><span class="in">`launch`</span> python applications across any number of accelerators on any of the</span>
<span id="cb10-113"><a href="#cb10-113"></a>systems under consideration.</span>
<span id="cb10-114"><a href="#cb10-114"></a></span>
<span id="cb10-115"><a href="#cb10-115"></a>In order to do this, there is some basic setup and information gathering that</span>
<span id="cb10-116"><a href="#cb10-116"></a>needs to occur.</span>
<span id="cb10-117"><a href="#cb10-117"></a></span>
<span id="cb10-118"><a href="#cb10-118"></a>In particular, we need mechanisms for:</span>
<span id="cb10-119"><a href="#cb10-119"></a></span>
<span id="cb10-120"><a href="#cb10-120"></a><span class="ss">1. </span>Setting up a python environment</span>
<span id="cb10-121"><a href="#cb10-121"></a><span class="ss">1. </span>Determining what system / machine we're on</span>
<span id="cb10-122"><a href="#cb10-122"></a><span class="ss">   - </span><span class="sc">\+</span> what job scheduler we're using (e.g. <span class="in">`PBS Pro`</span> @ ALCF or <span class="in">`slurm`</span></span>
<span id="cb10-123"><a href="#cb10-123"></a>   elsewhere)</span>
<span id="cb10-124"><a href="#cb10-124"></a><span class="ss">1. </span>Determining how many nodes have been allocated in the current job (<span class="in">`NHOSTS`</span>)</span>
<span id="cb10-125"><a href="#cb10-125"></a><span class="ss">   - </span><span class="sc">\+</span> Determining how many accelerators exist on each of these nodes</span>
<span id="cb10-126"><a href="#cb10-126"></a>   (<span class="in">`NGPU_PER_HOST`</span>)</span>
<span id="cb10-127"><a href="#cb10-127"></a></span>
<span id="cb10-128"><a href="#cb10-128"></a>This allows us to calculate the total number of accelerators (GPUs) as:</span>
<span id="cb10-129"><a href="#cb10-129"></a>$N_{\mathrm{GPU}} = N_{\mathrm{HOST}} \times n_{\mathrm{GPU}}$</span>
<span id="cb10-130"><a href="#cb10-130"></a></span>
<span id="cb10-131"><a href="#cb10-131"></a>where $n_{\mathrm{GPU}} = N_{\mathrm{GPU}} / N_{\mathrm{HOST}}$ is the number</span>
<span id="cb10-132"><a href="#cb10-132"></a>of GPUs per host.</span>
<span id="cb10-133"><a href="#cb10-133"></a></span>
<span id="cb10-134"><a href="#cb10-134"></a>With this we have everything we need to build the appropriate {<span class="in">`mpi`</span>{<span class="in">`run`</span>,</span>
<span id="cb10-135"><a href="#cb10-135"></a><span class="in">`exec`</span>}, <span class="in">`slurm`</span>} command for launching our python application across them.</span>
<span id="cb10-136"><a href="#cb10-136"></a></span>
<span id="cb10-137"><a href="#cb10-137"></a>Now, there are a few functions in particular worth elaborating on.</span>
<span id="cb10-138"><a href="#cb10-138"></a></span>
<span id="cb10-139"><a href="#cb10-139"></a>::: {#tbl-shell-fns}</span>
<span id="cb10-140"><a href="#cb10-140"></a></span>
<span id="cb10-141"><a href="#cb10-141"></a>| <span class="dv">&amp;nbsp;</span>                                                   | Function                     | Description                                                                               |</span>
<span id="cb10-142"><a href="#cb10-142"></a>| :------------------------------------------------------ | :--------------------------  | :-----------                                                                              |</span>
<span id="cb10-143"><a href="#cb10-143"></a>| <span class="co">[</span><span class="ot">Setup Environment</span><span class="co">](#setup-environment)</span>                  | <span class="in">`ezpz_setup_env`</span>             | Wrapper around <span class="in">`ezpz_setup_python &amp;&amp; ezpz_setup_job`</span>                                      |</span>
<span id="cb10-144"><a href="#cb10-144"></a>| <span class="co">[</span><span class="ot">Setup Job</span><span class="co">](#setup-job)</span>                                  | <span class="in">`ezpz_setup_job`</span>             | Determine {<span class="in">`NGPUS`</span>, <span class="in">`NGPU_PER_HOST`</span>, <span class="in">`NHOSTS`</span>}, build <span class="in">`launch`</span> command alias              |</span>
<span id="cb10-145"><a href="#cb10-145"></a>| <span class="co">[</span><span class="ot">Setup Python</span><span class="co">](#setup-python)</span>                            | <span class="in">`ezpz_setup_python`</span>          | Load python modules and activate virtual environment                                      |</span>
<span id="cb10-146"><a href="#cb10-146"></a>| <span class="co">[</span><span class="ot">Setup Conda</span><span class="co">](#setup-conda)</span>                              | <span class="in">`ezpz_setup_conda`</span>           | Identify appropriate <span class="in">`conda`</span> module to load                                               |</span>
<span id="cb10-147"><a href="#cb10-147"></a>| <span class="co">[</span><span class="ot">Setup Virtual Environment</span><span class="co">](#setup-virtual-environment)</span>  | <span class="in">`ezpz_setup_venv_from_conda`</span> | From <span class="in">`${CONDA_NAME}`</span>, build or activate the virtual env located in <span class="in">`venvs/${CONDA_NAME}/`</span> |</span>
<span id="cb10-148"><a href="#cb10-148"></a></span>
<span id="cb10-149"><a href="#cb10-149"></a>: Shell Functions {.responsive .striped .hover}</span>
<span id="cb10-150"><a href="#cb10-150"></a>:::</span>
<span id="cb10-151"><a href="#cb10-151"></a></span>
<span id="cb10-152"><a href="#cb10-152"></a><span class="co">&lt;!--1. Setup Environment: `ezpz_setup_env`.--&gt;</span></span>
<span id="cb10-153"><a href="#cb10-153"></a><span class="co">&lt;!--   Wrapper to chain the following two commands with `&amp;&amp;`:--&gt;</span></span>
<span id="cb10-154"><a href="#cb10-154"></a><span class="co">&lt;!--```bash--&gt;</span></span>
<span id="cb10-155"><a href="#cb10-155"></a><span class="co">&lt;!--git clone https://github.com/saforem2/ezpz deps/ezpz--&gt;</span></span>
<span id="cb10-156"><a href="#cb10-156"></a><span class="co">&lt;!--export PBS_O_WORKDIR=$(pwd)--&gt;</span></span>
<span id="cb10-157"><a href="#cb10-157"></a><span class="co">&lt;!--source deps/ezpz/src/ezpz/bin/utils.sh--&gt;</span></span>
<span id="cb10-158"><a href="#cb10-158"></a><span class="co">&lt;!--ezpz_setup_python--&gt;</span></span>
<span id="cb10-159"><a href="#cb10-159"></a><span class="co">&lt;!--ezpz_setup_job--&gt;</span></span>
<span id="cb10-160"><a href="#cb10-160"></a><span class="co">&lt;!--```--&gt;</span></span>
<span id="cb10-161"><a href="#cb10-161"></a><span class="co"> &lt;!-- 1. [Setup Pyhon](#setup-python): `ezpz_setup_python` --&gt;</span></span>
<span id="cb10-162"><a href="#cb10-162"></a><span class="co"> &lt;!-- 1. [Setup Job](#setup-job): `ezpz_setup_job` --&gt;</span></span>
<span id="cb10-163"><a href="#cb10-163"></a></span>
<span id="cb10-164"><a href="#cb10-164"></a>::: {.callout-warning collapse=false title="Where am I?"}</span>
<span id="cb10-165"><a href="#cb10-165"></a></span>
<span id="cb10-166"><a href="#cb10-166"></a>_Some_ of the `ezpz_*` functions</span>
<span id="cb10-167"><a href="#cb10-167"></a>(e.g. <span class="in">`ezpz_setup_python`</span>),</span>
<span id="cb10-168"><a href="#cb10-168"></a>will try to create / look for certain directories.</span>
<span id="cb10-169"><a href="#cb10-169"></a></span>
<span id="cb10-170"><a href="#cb10-170"></a>In an effort to be explicit,</span>
<span id="cb10-171"><a href="#cb10-171"></a>these directories will be defined</span>
<span id="cb10-172"><a href="#cb10-172"></a>**relative to** a <span class="in">`WORKING_DIR`</span></span>
<span id="cb10-173"><a href="#cb10-173"></a>(e.g. <span class="in">`"${WORKING_DIR}/venvs/"`</span>)</span>
<span id="cb10-174"><a href="#cb10-174"></a></span>
<span id="cb10-175"><a href="#cb10-175"></a>This <span class="in">`WORKING_DIR`</span> will be assigned to the first non-zero match found below:</span>
<span id="cb10-176"><a href="#cb10-176"></a></span>
<span id="cb10-177"><a href="#cb10-177"></a><span class="ss">1. </span><span class="in">`PBS_O_WORKDIR`</span>: If found in environment, paths will be relative to this</span>
<span id="cb10-178"><a href="#cb10-178"></a><span class="ss">2. </span><span class="in">`SLURM_SUBMIT_DIR`</span>: Next in line. If not @ ALCF, maybe using <span class="in">`slurm`</span>...</span>
<span id="cb10-179"><a href="#cb10-179"></a><span class="ss">3. </span><span class="in">`$(pwd)`</span>: Otherwise, no worries. Use your _actual_ working directory.</span>
<span id="cb10-180"><a href="#cb10-180"></a></span>
<span id="cb10-181"><a href="#cb10-181"></a>:::</span>
<span id="cb10-182"><a href="#cb10-182"></a></span>
<span id="cb10-183"><a href="#cb10-183"></a><span class="fu">#### üõ†Ô∏è Setup Python</span></span>
<span id="cb10-184"><a href="#cb10-184"></a></span>
<span id="cb10-185"><a href="#cb10-185"></a><span class="in">```bash</span></span>
<span id="cb10-186"><a href="#cb10-186"></a><span class="ex">ezpz_setup_python</span></span>
<span id="cb10-187"><a href="#cb10-187"></a><span class="in">```</span></span>
<span id="cb10-188"><a href="#cb10-188"></a></span>
<span id="cb10-189"><a href="#cb10-189"></a>This will:</span>
<span id="cb10-190"><a href="#cb10-190"></a></span>
<span id="cb10-191"><a href="#cb10-191"></a><span class="ss">1. </span>Automatically load and activate <span class="in">`conda`</span> using the <span class="in">`ezpz_setup_conda`</span> function.</span>
<span id="cb10-192"><a href="#cb10-192"></a></span>
<span id="cb10-193"><a href="#cb10-193"></a>   How this is done, in practice, varies from machine to machine:</span>
<span id="cb10-194"><a href="#cb10-194"></a></span>
<span id="cb10-195"><a href="#cb10-195"></a><span class="ss">   - </span>**ALCF**<span class="ot">[^alcf]</span>: Automatically load</span>
<span id="cb10-196"><a href="#cb10-196"></a>     the most recent <span class="in">`conda`</span> module and activate the base environment.</span>
<span id="cb10-197"><a href="#cb10-197"></a></span>
<span id="cb10-198"><a href="#cb10-198"></a>     <span class="ot">[^alcf]: </span>Any of {Aurora, Polaris, Sophia, Sunspot, Sirius}</span>
<span id="cb10-199"><a href="#cb10-199"></a></span>
<span id="cb10-200"><a href="#cb10-200"></a><span class="ss">   - </span>**Frontier**: Load the appropriate AMD modules (e.g. <span class="in">`rocm`</span>,</span>
<span id="cb10-201"><a href="#cb10-201"></a>     <span class="in">`RCCL`</span>, etc.), and activate base <span class="in">`conda`</span></span>
<span id="cb10-202"><a href="#cb10-202"></a></span>
<span id="cb10-203"><a href="#cb10-203"></a><span class="ss">   - </span>**Perlmutter**: Load the appropriate <span class="in">`pytorch`</span> module and activate environment</span>
<span id="cb10-204"><a href="#cb10-204"></a></span>
<span id="cb10-205"><a href="#cb10-205"></a><span class="ss">   - </span>**Unknown**: In this case, we will look for a <span class="in">`conda`</span>, <span class="in">`mamba`</span>, or</span>
<span id="cb10-206"><a href="#cb10-206"></a>     <span class="in">`micromamba`</span> executable, and if found, use that to activate the base</span>
<span id="cb10-207"><a href="#cb10-207"></a>     environment.</span>
<span id="cb10-208"><a href="#cb10-208"></a></span>
<span id="cb10-209"><a href="#cb10-209"></a></span>
<span id="cb10-210"><a href="#cb10-210"></a>   ::: {.callout-tip title="Using your own <span class="in">`conda`</span>"}</span>
<span id="cb10-211"><a href="#cb10-211"></a></span>
<span id="cb10-212"><a href="#cb10-212"></a>   If you are already in a conda environment when calling</span>
<span id="cb10-213"><a href="#cb10-213"></a>   <span class="in">`ezpz_setup_python`</span> then it will try and use this instead.</span>
<span id="cb10-214"><a href="#cb10-214"></a></span>
<span id="cb10-215"><a href="#cb10-215"></a>   For example, if you have a custom <span class="in">`conda`</span> env at <span class="in">`~/conda/envs/custom`</span>, then</span>
<span id="cb10-216"><a href="#cb10-216"></a>   this would bootstrap the <span class="in">`custom`</span> conda environment and create the virtual</span>
<span id="cb10-217"><a href="#cb10-217"></a>   env in <span class="in">`venvs/custom/`</span></span>
<span id="cb10-218"><a href="#cb10-218"></a></span>
<span id="cb10-219"><a href="#cb10-219"></a>   :::</span>
<span id="cb10-220"><a href="#cb10-220"></a></span>
<span id="cb10-221"><a href="#cb10-221"></a><span class="ss">2. </span>Build (or activate, if found) a virtual environment on top of (the active) base <span class="in">`conda`</span> environment.</span>
<span id="cb10-222"><a href="#cb10-222"></a></span>
<span id="cb10-223"><a href="#cb10-223"></a>   By default, it will try looking in:</span>
<span id="cb10-224"><a href="#cb10-224"></a></span>
<span id="cb10-225"><a href="#cb10-225"></a><span class="ss">   - </span><span class="in">`$PBS_O_WORKDIR`</span>, otherwise</span>
<span id="cb10-226"><a href="#cb10-226"></a><span class="ss">   - </span><span class="in">`${SLURM_SUBMIT_DIR}`</span>, otherwise</span>
<span id="cb10-227"><a href="#cb10-227"></a><span class="ss">   - </span><span class="in">`$(pwd)`</span></span>
<span id="cb10-228"><a href="#cb10-228"></a></span>
<span id="cb10-229"><a href="#cb10-229"></a>   for a nested folder named <span class="in">`"venvs/${CONDA_NAME}"`</span>.</span>
<span id="cb10-230"><a href="#cb10-230"></a></span>
<span id="cb10-231"><a href="#cb10-231"></a>   If this doesn't exist, it will attempt to create a new virtual environment</span>
<span id="cb10-232"><a href="#cb10-232"></a>   at this location using:</span>
<span id="cb10-233"><a href="#cb10-233"></a></span>
<span id="cb10-234"><a href="#cb10-234"></a>   <span class="in">```bash</span></span>
<span id="cb10-235"><a href="#cb10-235"></a>   <span class="ex">python3</span> <span class="at">-m</span> venv venvs/<span class="va">${CONDA_NAME}</span> <span class="at">--system-site-packages</span></span>
<span id="cb10-236"><a href="#cb10-236"></a>   <span class="in">```</span></span>
<span id="cb10-237"><a href="#cb10-237"></a></span>
<span id="cb10-238"><a href="#cb10-238"></a>   (where we've pulled in the <span class="in">`--system-site-packages`</span> from conda).</span>
<span id="cb10-239"><a href="#cb10-239"></a></span>
<span id="cb10-240"><a href="#cb10-240"></a><span class="fu">#### üß∞ Setup Job</span></span>
<span id="cb10-241"><a href="#cb10-241"></a></span>
<span id="cb10-242"><a href="#cb10-242"></a><span class="in">```bash</span></span>
<span id="cb10-243"><a href="#cb10-243"></a><span class="ex">ezpz_setup_job</span></span>
<span id="cb10-244"><a href="#cb10-244"></a><span class="in">```</span></span>
<span id="cb10-245"><a href="#cb10-245"></a></span>
<span id="cb10-246"><a href="#cb10-246"></a><span class="co">&lt;!-- Now, we are in a suitable python environment with the necessary pre-requisites --&gt;</span></span>
<span id="cb10-247"><a href="#cb10-247"></a><span class="co">&lt;!-- installed (e.g. `torch`, `mpi4py`, `deepspeed` (optional)). --&gt;</span></span>
<span id="cb10-248"><a href="#cb10-248"></a><span class="co">&lt;!----&gt;</span></span>
<span id="cb10-249"><a href="#cb10-249"></a><span class="co">&lt;!-- Next, we would like to build the appropriate command to launch `python3` --&gt;</span></span>
<span id="cb10-250"><a href="#cb10-250"></a><span class="co">&lt;!----&gt;</span></span>
<span id="cb10-251"><a href="#cb10-251"></a><span class="co">&lt;!-- across our accelerators. --&gt;</span></span>
<span id="cb10-252"><a href="#cb10-252"></a></span>
<span id="cb10-253"><a href="#cb10-253"></a>Now that we are in a suitable python environment, we need to construct the</span>
<span id="cb10-254"><a href="#cb10-254"></a>command that we will use to run python on each of our acceleratorss.</span>
<span id="cb10-255"><a href="#cb10-255"></a></span>
<span id="cb10-256"><a href="#cb10-256"></a>To do this, we need a few things:</span>
<span id="cb10-257"><a href="#cb10-257"></a></span>
<span id="cb10-258"><a href="#cb10-258"></a><span class="ss">1. </span>What machine we're on (and what scheduler is it using i.e. {PBS, SLURM})</span>
<span id="cb10-259"><a href="#cb10-259"></a><span class="ss">2. </span>How many nodes are available in our active job</span>
<span id="cb10-260"><a href="#cb10-260"></a><span class="ss">3. </span>How many GPUs are on each of those nodes</span>
<span id="cb10-261"><a href="#cb10-261"></a><span class="ss">4. </span>What type of GPUs are they</span>
<span id="cb10-262"><a href="#cb10-262"></a></span>
<span id="cb10-263"><a href="#cb10-263"></a>With this information, we can then use <span class="in">`mpi{exec,run}`</span> or <span class="in">`srun`</span> to launch</span>
<span id="cb10-264"><a href="#cb10-264"></a>python across all of our accelerators.</span>
<span id="cb10-265"><a href="#cb10-265"></a></span>
<span id="cb10-266"><a href="#cb10-266"></a>Again, how this is done will vary from machine to machine and will depend on</span>
<span id="cb10-267"><a href="#cb10-267"></a>the job scheduler in use.</span>
<span id="cb10-268"><a href="#cb10-268"></a></span>
<span id="cb10-269"><a href="#cb10-269"></a>To identify where we are, we look at our <span class="in">`$(hostname)`</span> and see if we're running</span>
<span id="cb10-270"><a href="#cb10-270"></a>on one of the known machines:</span>
<span id="cb10-271"><a href="#cb10-271"></a></span>
<span id="cb10-272"><a href="#cb10-272"></a><span class="ss">- </span>**ALCF**<span class="ot">[^node-names]</span>: Using PBS Pro via <span class="in">`qsub`</span> and <span class="in">`mpiexec`</span> / <span class="in">`mpirun`</span>.</span>
<span id="cb10-273"><a href="#cb10-273"></a><span class="ss">  - </span><span class="in">`x4*`</span>: **Aurora**</span>
<span id="cb10-274"><a href="#cb10-274"></a><span class="ss">  - </span>**Aurora**: <span class="in">`x4*`</span> (or <span class="in">`aurora*`</span> on login nodes)</span>
<span id="cb10-275"><a href="#cb10-275"></a><span class="ss">  - </span>**Sunspot**: <span class="in">`x1*`</span> (or <span class="in">`uan*`</span>)</span>
<span id="cb10-276"><a href="#cb10-276"></a><span class="ss">  - </span>**Sophia**: <span class="in">`sophia-*`</span></span>
<span id="cb10-277"><a href="#cb10-277"></a><span class="ss">  - </span>**Polaris** / **Sirius**: <span class="in">`x3*`</span></span>
<span id="cb10-278"><a href="#cb10-278"></a><span class="ss">    - </span>to determine between the two, we look at <span class="in">`"${PBS_O_HOST}"`</span></span>
<span id="cb10-279"><a href="#cb10-279"></a></span>
<span id="cb10-280"><a href="#cb10-280"></a></span>
<span id="cb10-281"><a href="#cb10-281"></a><span class="ot">[^node-names]: </span>At ALCF, if our <span class="in">`$(hostname)`</span> starts with <span class="in">`x*`</span>, we're on a</span>
<span id="cb10-282"><a href="#cb10-282"></a>    compute node.</span>
<span id="cb10-283"><a href="#cb10-283"></a></span>
<span id="cb10-284"><a href="#cb10-284"></a><span class="ss">- </span>**OLCF**: Using Slurm via <span class="in">`sbatch`</span> / <span class="in">`srun`</span>.</span>
<span id="cb10-285"><a href="#cb10-285"></a></span>
<span id="cb10-286"><a href="#cb10-286"></a><span class="ss">  - </span><span class="in">`frontier*`</span>: **Frontier**, using Slurm</span>
<span id="cb10-287"><a href="#cb10-287"></a><span class="ss">  - </span><span class="in">`nid*`</span>: Perlmutter, using Slurm</span>
<span id="cb10-288"><a href="#cb10-288"></a></span>
<span id="cb10-289"><a href="#cb10-289"></a></span>
<span id="cb10-290"><a href="#cb10-290"></a><span class="ss">- </span>Unknown machine: If <span class="in">`$(hostname)`</span> does not match one of these patterns we</span>
<span id="cb10-291"><a href="#cb10-291"></a>  assume that we are running on an unknown machine and will try to use <span class="in">`mpirun`</span></span>
<span id="cb10-292"><a href="#cb10-292"></a>  as our generic launch command</span>
<span id="cb10-293"><a href="#cb10-293"></a></span>
<span id="cb10-294"><a href="#cb10-294"></a></span>
<span id="cb10-295"><a href="#cb10-295"></a>  Once we have this, we can:</span>
<span id="cb10-296"><a href="#cb10-296"></a></span>
<span id="cb10-297"><a href="#cb10-297"></a><span class="ss">  1. </span>Get <span class="in">`PBS_NODEFILE`</span> from <span class="in">`$(hostname)`</span>:</span>
<span id="cb10-298"><a href="#cb10-298"></a></span>
<span id="cb10-299"><a href="#cb10-299"></a><span class="ss">      - </span><span class="in">`ezpz_qsme_running`</span>: For each (running) job owned by <span class="in">`${USER}`</span>, print</span>
<span id="cb10-300"><a href="#cb10-300"></a>      out both the jobid as well as a list of hosts the job is running on,</span>
<span id="cb10-301"><a href="#cb10-301"></a>      e.g.:</span>
<span id="cb10-302"><a href="#cb10-302"></a></span>
<span id="cb10-303"><a href="#cb10-303"></a>        <span class="in">```bash</span></span>
<span id="cb10-304"><a href="#cb10-304"></a>        <span class="op">&lt;</span>jobid0<span class="op">&gt;</span> host00 <span class="ex">host01</span> host02 host03 ...</span>
<span id="cb10-305"><a href="#cb10-305"></a>        <span class="op">&lt;</span>jobid1<span class="op">&gt;</span> host10 <span class="ex">host11</span> host12 host13 ...</span>
<span id="cb10-306"><a href="#cb10-306"></a>        <span class="ex">...</span></span>
<span id="cb10-307"><a href="#cb10-307"></a>        <span class="in">```</span></span>
<span id="cb10-308"><a href="#cb10-308"></a></span>
<span id="cb10-309"><a href="#cb10-309"></a><span class="ss">      - </span><span class="in">`ezpz_get_pbs_nodefile_from_hostname`</span>: Look for <span class="in">`$(hostname)`</span> in the</span>
<span id="cb10-310"><a href="#cb10-310"></a>        output from the above command to determine our <span class="in">`${PBS_JOBID}`</span>.</span>
<span id="cb10-311"><a href="#cb10-311"></a></span>
<span id="cb10-312"><a href="#cb10-312"></a>        Once we've identified our <span class="in">`${PBS_JOBID}`</span> we then know the location of</span>
<span id="cb10-313"><a href="#cb10-313"></a>        our <span class="in">`${PBS_NODEFILE}`</span> since they are named according to:</span>
<span id="cb10-314"><a href="#cb10-314"></a></span>
<span id="cb10-315"><a href="#cb10-315"></a>        <span class="in">```bash</span></span>
<span id="cb10-316"><a href="#cb10-316"></a>        <span class="va">jobid</span><span class="op">=</span><span class="va">$(</span><span class="ex">ezpz_qsme_running</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"</span><span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'{print $1}'</span><span class="va">)</span></span>
<span id="cb10-317"><a href="#cb10-317"></a>        <span class="va">prefix</span><span class="op">=</span>/var/spool/pbs/aux</span>
<span id="cb10-318"><a href="#cb10-318"></a>        <span class="va">match</span><span class="op">=</span><span class="va">$(</span><span class="ex">/bin/ls</span> <span class="st">"</span><span class="va">${prefix}</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"</span><span class="va">${jobid}</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb10-319"><a href="#cb10-319"></a>        <span class="va">hostfile</span><span class="op">=</span><span class="st">"</span><span class="va">${prefix}</span><span class="st">/</span><span class="va">${match}</span><span class="st">"</span></span>
<span id="cb10-320"><a href="#cb10-320"></a>        <span class="in">```</span></span>
<span id="cb10-321"><a href="#cb10-321"></a></span>
<span id="cb10-322"><a href="#cb10-322"></a></span>
<span id="cb10-323"><a href="#cb10-323"></a><span class="ss">  2. </span>Identify number of available accelerators:</span>
<span id="cb10-324"><a href="#cb10-324"></a></span>
<span id="cb10-325"><a href="#cb10-325"></a></span>
<span id="cb10-326"><a href="#cb10-326"></a><span class="fu">## üêç Python Library</span></span>
<span id="cb10-327"><a href="#cb10-327"></a></span>
<span id="cb10-328"><a href="#cb10-328"></a>To install<span class="ot">[^require-venv]</span>:</span>
<span id="cb10-329"><a href="#cb10-329"></a></span>
<span id="cb10-330"><a href="#cb10-330"></a><span class="in">```bash</span></span>
<span id="cb10-331"><a href="#cb10-331"></a><span class="ex">python3</span> <span class="at">-m</span> pip install <span class="at">-e</span> <span class="st">"git+https://github.com/saforem2/ezpz#egg=ezpz"</span> <span class="at">--require-virtualenv</span></span>
<span id="cb10-332"><a href="#cb10-332"></a><span class="in">```</span></span>
<span id="cb10-333"><a href="#cb10-333"></a></span>
<span id="cb10-334"><a href="#cb10-334"></a><span class="ot">[^require-venv]: </span>Note the <span class="in">`--require-virtualenv`</span> isn't _strictly_ required, but</span>
<span id="cb10-335"><a href="#cb10-335"></a>    I highly recommend to always try and work within a virtual environment,</span>
<span id="cb10-336"><a href="#cb10-336"></a>    when possible.</span>
<span id="cb10-337"><a href="#cb10-337"></a></span>
<span id="cb10-338"><a href="#cb10-338"></a><span class="co">&lt;!--</span></span>
<span id="cb10-339"><a href="#cb10-339"></a><span class="co">- Clone repo[^location]:</span></span>
<span id="cb10-340"><a href="#cb10-340"></a></span>
<span id="cb10-341"><a href="#cb10-341"></a><span class="co">   ```bash</span></span>
<span id="cb10-342"><a href="#cb10-342"></a><span class="co">   git clone https://github.com/saforem2/ezpz deps/ezpz</span></span>
<span id="cb10-343"><a href="#cb10-343"></a><span class="co">   ```</span></span>
<span id="cb10-344"><a href="#cb10-344"></a></span>
<span id="cb10-345"><a href="#cb10-345"></a><span class="co">[^location]: _Where_, specifically, you clone it into (e.g. `deps/ezpz` here),</span></span>
<span id="cb10-346"><a href="#cb10-346"></a><span class="co">    isn't terribly important.</span></span>
<span id="cb10-347"><a href="#cb10-347"></a></span>
<span id="cb10-348"><a href="#cb10-348"></a><span class="co">    I usually choose to nest it inside a `deps/` directory to avoid the case</span></span>
<span id="cb10-349"><a href="#cb10-349"></a><span class="co">    where you have installed `ezpz` as a python library but you've additionally got</span></span>
<span id="cb10-350"><a href="#cb10-350"></a><span class="co">    a folder named `ezpz` in your working directory.</span></span>
<span id="cb10-351"><a href="#cb10-351"></a></span>
<span id="cb10-352"><a href="#cb10-352"></a><span class="co">    For example:</span></span>
<span id="cb10-353"><a href="#cb10-353"></a></span>
<span id="cb10-354"><a href="#cb10-354"></a><span class="co">    ```bash</span></span>
<span id="cb10-355"><a href="#cb10-355"></a><span class="co">    $ cd /path/to/your/project</span></span>
<span id="cb10-356"><a href="#cb10-356"></a><span class="co">    $ PBS_O_WORKDIR=$(pwd) source /dev/stdin &lt;&lt;&lt; $(curl 'https://raw.githubusercontent.com/saforem2/ezpz/refs/heads/main/src/ezpz/bin/utils.sh')</span></span>
<span id="cb10-357"><a href="#cb10-357"></a><span class="co">    $ ezpz_setup_env  # just chains ezpz_setup_python + ezpz_setup_job</span></span>
<span id="cb10-358"><a href="#cb10-358"></a><span class="co">    (venv) $ python3 -m pip install -e "git+https://github.com/saforem2/ezpz#egg=ezpz" --require-virtualenv</span></span>
<span id="cb10-359"><a href="#cb10-359"></a><span class="co">    ```</span></span>
<span id="cb10-360"><a href="#cb10-360"></a></span>
<span id="cb10-361"><a href="#cb10-361"></a><span class="co">    ```bash</span></span>
<span id="cb10-362"><a href="#cb10-362"></a><span class="co">    $ git clone https://github.com/saforem2/ezpz</span></span>
<span id="cb10-363"><a href="#cb10-363"></a><span class="co">    $ python3 -m pip install -e ezpz</span></span>
<span id="cb10-364"><a href="#cb10-364"></a><span class="co">    ```</span></span>
<span id="cb10-365"><a href="#cb10-365"></a><span class="co">--&gt;</span></span>
<span id="cb10-366"><a href="#cb10-366"></a></span>
<span id="cb10-367"><a href="#cb10-367"></a></span>
<span id="cb10-368"><a href="#cb10-368"></a><span class="ss">- </span>üìÇ <span class="co">[</span><span class="ot">`bin/`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/bin/)</span>:</span>
<span id="cb10-369"><a href="#cb10-369"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">`ezpz/bin/utils.sh`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/bin/utils.sh)</span>: Common utilities for EZPZ</span>
<span id="cb10-370"><a href="#cb10-370"></a><span class="ss">- </span>üìÇ <span class="co">[</span><span class="ot">`conf/`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/conf/)</span>:</span>
<span id="cb10-371"><a href="#cb10-371"></a><span class="ss">  - </span>‚öôÔ∏è <span class="co">[</span><span class="ot">`conf/config.yaml`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/conf/config.yaml)</span>:  Default <span class="in">`TrainConfig`</span> object</span>
<span id="cb10-372"><a href="#cb10-372"></a><span class="ss">  - </span>‚öôÔ∏è <span class="co">[</span><span class="ot">`conf/ds_config.json`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/conf/ds_config.json)</span>: DeepSpeed configuration</span>
<span id="cb10-373"><a href="#cb10-373"></a><span class="ss">- </span>üìÇ <span class="co">[</span><span class="ot">`log/`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/log/)</span>: Logging configuration.</span>
<span id="cb10-374"><a href="#cb10-374"></a><span class="ss">- </span>üêç <span class="co">[</span><span class="ot">`__about__.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/__about__.py)</span>: Version information</span>
<span id="cb10-375"><a href="#cb10-375"></a><span class="ss">- </span>üêç <span class="co">[</span><span class="ot">`__init__.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/__init__.py)</span>: Main module</span>
<span id="cb10-376"><a href="#cb10-376"></a><span class="ss">- </span>üêç <span class="co">[</span><span class="ot">`__main__.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/__main__.py)</span>: Entry point</span>
<span id="cb10-377"><a href="#cb10-377"></a><span class="ss">- </span>üêç <span class="co">[</span><span class="ot">`configs.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/configs.py)</span>: Configuration module</span>
<span id="cb10-378"><a href="#cb10-378"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`cria.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/create.py)</span>: Baby Llama</span>
<span id="cb10-379"><a href="#cb10-379"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">**`dist.py`**</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/dist.py)</span>: Distributed training module</span>
<span id="cb10-380"><a href="#cb10-380"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">_`history.py`_</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/history.py)</span>: History module</span>
<span id="cb10-381"><a href="#cb10-381"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`jobs.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/jobs.py)</span>: Jobs module</span>
<span id="cb10-382"><a href="#cb10-382"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`model.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/model.py)</span>: Model module</span>
<span id="cb10-383"><a href="#cb10-383"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`plot.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/plot.py)</span>: Plot modul</span>
<span id="cb10-384"><a href="#cb10-384"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`profile.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/profile.py)</span>: Profile module</span>
<span id="cb10-385"><a href="#cb10-385"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`runtime.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/runtime.py)</span>: Runtime module</span>
<span id="cb10-386"><a href="#cb10-386"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`test.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/test.py)</span>: Test module</span>
<span id="cb10-387"><a href="#cb10-387"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">**`test_dist.py`**</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/test_dist.py)</span>: Distributed training test module</span>
<span id="cb10-388"><a href="#cb10-388"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`train.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/train.py)</span>: train module</span>
<span id="cb10-389"><a href="#cb10-389"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`trainer.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/trainer.py)</span>: trainer module</span>
<span id="cb10-390"><a href="#cb10-390"></a><span class="ss">- </span>üêç<span class="co">[</span><span class="ot">`utils.py`</span><span class="co">](https://github.com/saforem2/ezpz/blob/main/src/ezpz/utils.py)</span>: utility module</span>
<span id="cb10-391"><a href="#cb10-391"></a></span>
<span id="cb10-392"><a href="#cb10-392"></a></span>
<span id="cb10-393"><a href="#cb10-393"></a></span>
<span id="cb10-394"><a href="#cb10-394"></a></span>
<span id="cb10-395"><a href="#cb10-395"></a></span>
<span id="cb10-396"><a href="#cb10-396"></a></span>
<span id="cb10-397"><a href="#cb10-397"></a><span class="in">```bash</span></span>
<span id="cb10-398"><a href="#cb10-398"></a><span class="ex">üìÇ</span> /ezpz/src/ezpz/</span>
<span id="cb10-399"><a href="#cb10-399"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üìÇ bin/</span>
<span id="cb10-400"><a href="#cb10-400"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ affinity.sh</span>
<span id="cb10-401"><a href="#cb10-401"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ getjobenv</span>
<span id="cb10-402"><a href="#cb10-402"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ savejobenv</span>
<span id="cb10-403"><a href="#cb10-403"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ saveslurmenv</span>
<span id="cb10-404"><a href="#cb10-404"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ setup.sh</span>
<span id="cb10-405"><a href="#cb10-405"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ train.sh</span>
<span id="cb10-406"><a href="#cb10-406"></a><span class="ex">‚îÉ</span>   ‚îó‚îÅ‚îÅ üìÑ utils.sh</span>
<span id="cb10-407"><a href="#cb10-407"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üìÇ conf/</span>
<span id="cb10-408"><a href="#cb10-408"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÇ hydra/</span>
<span id="cb10-409"><a href="#cb10-409"></a><span class="ex">‚îÉ</span>   ‚îÉ   ‚îó‚îÅ‚îÅ üìÇ job_logging/</span>
<span id="cb10-410"><a href="#cb10-410"></a><span class="ex">‚îÉ</span>   ‚îÉ       ‚î£‚îÅ‚îÅ ‚öôÔ∏è colorlog1.yaml</span>
<span id="cb10-411"><a href="#cb10-411"></a><span class="ex">‚îÉ</span>   ‚îÉ       ‚î£‚îÅ‚îÅ ‚öôÔ∏è custom.yaml</span>
<span id="cb10-412"><a href="#cb10-412"></a><span class="ex">‚îÉ</span>   ‚îÉ       ‚îó‚îÅ‚îÅ ‚öôÔ∏è enrich.yaml</span>
<span id="cb10-413"><a href="#cb10-413"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÇ logdir/</span>
<span id="cb10-414"><a href="#cb10-414"></a><span class="ex">‚îÉ</span>   ‚îÉ   ‚îó‚îÅ‚îÅ ‚öôÔ∏è default.yaml</span>
<span id="cb10-415"><a href="#cb10-415"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ ‚öôÔ∏è config.yaml</span>
<span id="cb10-416"><a href="#cb10-416"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÑ ds_config.json</span>
<span id="cb10-417"><a href="#cb10-417"></a><span class="ex">‚îÉ</span>   ‚îó‚îÅ‚îÅ ‚öôÔ∏è ds_config.yaml</span>
<span id="cb10-418"><a href="#cb10-418"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üìÇ log/</span>
<span id="cb10-419"><a href="#cb10-419"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üìÇ conf/</span>
<span id="cb10-420"><a href="#cb10-420"></a><span class="ex">‚îÉ</span>   ‚îÉ   ‚îó‚îÅ‚îÅ üìÇ hydra/</span>
<span id="cb10-421"><a href="#cb10-421"></a><span class="ex">‚îÉ</span>   ‚îÉ       ‚îó‚îÅ‚îÅ üìÇ job_logging/</span>
<span id="cb10-422"><a href="#cb10-422"></a><span class="ex">‚îÉ</span>   ‚îÉ           ‚îó‚îÅ‚îÅ ‚öôÔ∏è enrich.yaml</span>
<span id="cb10-423"><a href="#cb10-423"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç __init__.py</span>
<span id="cb10-424"><a href="#cb10-424"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç __main__.py</span>
<span id="cb10-425"><a href="#cb10-425"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç config.py</span>
<span id="cb10-426"><a href="#cb10-426"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç console.py</span>
<span id="cb10-427"><a href="#cb10-427"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç handler.py</span>
<span id="cb10-428"><a href="#cb10-428"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç style.py</span>
<span id="cb10-429"><a href="#cb10-429"></a><span class="ex">‚îÉ</span>   ‚î£‚îÅ‚îÅ üêç test.py</span>
<span id="cb10-430"><a href="#cb10-430"></a><span class="ex">‚îÉ</span>   ‚îó‚îÅ‚îÅ üêç test_log.py</span>
<span id="cb10-431"><a href="#cb10-431"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç __about__.py</span>
<span id="cb10-432"><a href="#cb10-432"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç __init__.py</span>
<span id="cb10-433"><a href="#cb10-433"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç __main__.py</span>
<span id="cb10-434"><a href="#cb10-434"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç configs.py</span>
<span id="cb10-435"><a href="#cb10-435"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç cria.py</span>
<span id="cb10-436"><a href="#cb10-436"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç dist.py</span>
<span id="cb10-437"><a href="#cb10-437"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç history.py</span>
<span id="cb10-438"><a href="#cb10-438"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç jobs.py</span>
<span id="cb10-439"><a href="#cb10-439"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç loadjobenv.py</span>
<span id="cb10-440"><a href="#cb10-440"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç model.py</span>
<span id="cb10-441"><a href="#cb10-441"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç plot.py</span>
<span id="cb10-442"><a href="#cb10-442"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç profile.py</span>
<span id="cb10-443"><a href="#cb10-443"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç runtime.py</span>
<span id="cb10-444"><a href="#cb10-444"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç savejobenv.py</span>
<span id="cb10-445"><a href="#cb10-445"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç test.py</span>
<span id="cb10-446"><a href="#cb10-446"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç test_dist.py</span>
<span id="cb10-447"><a href="#cb10-447"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç train.py</span>
<span id="cb10-448"><a href="#cb10-448"></a><span class="ex">‚î£‚îÅ‚îÅ</span> üêç trainer.py</span>
<span id="cb10-449"><a href="#cb10-449"></a><span class="ex">‚îó‚îÅ‚îÅ</span> üêç utils.py</span>
<span id="cb10-450"><a href="#cb10-450"></a><span class="in">```</span></span>
<span id="cb10-451"><a href="#cb10-451"></a></span>
<span id="cb10-452"><a href="#cb10-452"></a></span>
<span id="cb10-453"><a href="#cb10-453"></a><span class="co">   &lt;!-- ```bash --&gt;</span></span>
<span id="cb10-454"><a href="#cb10-454"></a><span class="co">   &lt;!-- "${PBS_O_WORKDIR:-$(pwd)}/venvs/${CONDA_NAME}" --&gt;</span></span>
<span id="cb10-455"><a href="#cb10-455"></a><span class="co">   &lt;!-- ``` --&gt;</span></span>
<span id="cb10-456"><a href="#cb10-456"></a></span>
<span id="cb10-457"><a href="#cb10-457"></a><span class="co">   &lt;!-- Ideally, following step 1., we are now inside a suitable `conda` --&gt;</span></span>
<span id="cb10-458"><a href="#cb10-458"></a><span class="co">   &lt;!-- environment. --&gt;</span></span>
<span id="cb10-459"><a href="#cb10-459"></a><span class="co">   &lt;!----&gt;</span></span>
<span id="cb10-460"><a href="#cb10-460"></a><span class="co">   &lt;!-- Next, we will look for a virtual environment located in: --&gt;</span></span>
<span id="cb10-461"><a href="#cb10-461"></a><span class="co">   &lt;!----&gt;</span></span>
<span id="cb10-462"><a href="#cb10-462"></a><span class="co">   &lt;!-- ```bash --&gt;</span></span>
<span id="cb10-463"><a href="#cb10-463"></a><span class="co">   &lt;!-- venvs/${CONDA_NAME} --&gt;</span></span>
<span id="cb10-464"><a href="#cb10-464"></a><span class="co">   &lt;!-- ``` --&gt;</span></span>
<span id="cb10-465"><a href="#cb10-465"></a><span class="co">   &lt;!----&gt;</span></span>
<span id="cb10-466"><a href="#cb10-466"></a><span class="co">   &lt;!-- If this exists, activate it and continue. --&gt;</span></span>
<span id="cb10-467"><a href="#cb10-467"></a><span class="co">   &lt;!-- Otherwise, we will create a new `venv` via: --&gt;</span></span>
<span id="cb10-468"><a href="#cb10-468"></a><span class="co">   &lt;!----&gt;</span></span>
<span id="cb10-469"><a href="#cb10-469"></a></span>
<span id="cb10-470"><a href="#cb10-470"></a><span class="co">&lt;!-- `ezpz_setup_venv`:  --&gt;</span></span>
<span id="cb10-471"><a href="#cb10-471"></a></span>
<span id="cb10-472"><a href="#cb10-472"></a><span class="co">&lt;!-- base `conda` environment to build a `venv` on top of --&gt;</span></span>
<span id="cb10-473"><a href="#cb10-473"></a><span class="co">&lt;!-- Build (or activate, if already exists) a virtual environment on top of this  --&gt;</span></span>
<span id="cb10-474"><a href="#cb10-474"></a></span>
<span id="cb10-475"><a href="#cb10-475"></a><span class="co">&lt;!-- Place you inside a `venv/${CONDA_NAME}` (building it if needed)  --&gt;</span></span>
<span id="cb10-476"><a href="#cb10-476"></a><span class="co">&lt;!-- This is done in two parts. --&gt;</span></span>
<span id="cb10-477"><a href="#cb10-477"></a><span class="co">&lt;!----&gt;</span></span>
<span id="cb10-478"><a href="#cb10-478"></a><span class="co">&lt;!-- 1. `ezpz_setup_conda`: Will first attempt to load and activate a suitable --&gt;</span></span>
<span id="cb10-479"><a href="#cb10-479"></a><span class="co">&lt;!--   `conda` environment. --&gt;</span></span>
<span id="cb10-480"><a href="#cb10-480"></a></span>
<span id="cb10-481"><a href="#cb10-481"></a></span>
<span id="cb10-482"><a href="#cb10-482"></a><span class="ot">[^completions]: </span>Plus this is useful for tab-completions in your shell, e.g.:</span>
<span id="cb10-483"><a href="#cb10-483"></a></span>
<span id="cb10-484"><a href="#cb10-484"></a><span class="in">    ```bash</span></span>
<span id="cb10-485"><a href="#cb10-485"></a><span class="in">    $ ezpz_&lt;TAB&gt;</span></span>
<span id="cb10-486"><a href="#cb10-486"></a><span class="in">    ezpz_check_and_kill_if_running</span></span>
<span id="cb10-487"><a href="#cb10-487"></a><span class="in">    ezpz_get_dist_launch_cmd</span></span>
<span id="cb10-488"><a href="#cb10-488"></a><span class="in">    ezpz_get_job_env</span></span>
<span id="cb10-489"><a href="#cb10-489"></a><span class="in">    --More--</span></span>
<span id="cb10-490"><a href="#cb10-490"></a><span class="in">    ```</span></span>
<span id="cb10-491"><a href="#cb10-491"></a></span>
<span id="cb10-492"><a href="#cb10-492"></a><span class="co">&lt;!-- ```bash --&gt;</span></span>
<span id="cb10-493"><a href="#cb10-493"></a><span class="co">&lt;!-- $ ezpz_&lt;TAB&gt; --&gt;</span></span>
<span id="cb10-494"><a href="#cb10-494"></a><span class="co">&lt;!-- ezpz_check_and_kill_if_running --&gt;</span></span>
<span id="cb10-495"><a href="#cb10-495"></a><span class="co">&lt;!-- ezpz_get_dist_launch_cmd --&gt;</span></span>
<span id="cb10-496"><a href="#cb10-496"></a><span class="co">&lt;!-- ezpz_get_job_env --&gt;</span></span>
<span id="cb10-497"><a href="#cb10-497"></a><span class="co">&lt;!-- ezpz_get_jobenv_file --&gt;</span></span>
<span id="cb10-498"><a href="#cb10-498"></a><span class="co">&lt;!-- ezpz_get_jobid_from_hostname --&gt;</span></span>
<span id="cb10-499"><a href="#cb10-499"></a><span class="co">&lt;!-- ezpz_get_machine_name --&gt;</span></span>
<span id="cb10-500"><a href="#cb10-500"></a><span class="co">&lt;!-- ezpz_get_num_gpus_nvidia --&gt;</span></span>
<span id="cb10-501"><a href="#cb10-501"></a><span class="co">&lt;!-- ezpz_get_num_gpus_per_host --&gt;</span></span>
<span id="cb10-502"><a href="#cb10-502"></a><span class="co">&lt;!-- ezpz_get_num_gpus_total --&gt;</span></span>
<span id="cb10-503"><a href="#cb10-503"></a><span class="co">&lt;!-- ezpz_get_num_hosts --&gt;</span></span>
<span id="cb10-504"><a href="#cb10-504"></a><span class="co">&lt;!-- ezpz_get_num_xpus --&gt;</span></span>
<span id="cb10-505"><a href="#cb10-505"></a><span class="co">&lt;!-- ezpz_get_pbs_env --&gt;</span></span>
<span id="cb10-506"><a href="#cb10-506"></a><span class="co">&lt;!-- ezpz_get_pbs_nodefile_from_hostname --&gt;</span></span>
<span id="cb10-507"><a href="#cb10-507"></a><span class="co">&lt;!-- ezpz_get_scheduler_type --&gt;</span></span>
<span id="cb10-508"><a href="#cb10-508"></a><span class="co">&lt;!-- ezpz_get_shell_name --&gt;</span></span>
<span id="cb10-509"><a href="#cb10-509"></a><span class="co">&lt;!-- ezpz_get_slurm_env --&gt;</span></span>
<span id="cb10-510"><a href="#cb10-510"></a><span class="co">&lt;!-- ezpz_get_slurm_running_jobid --&gt;</span></span>
<span id="cb10-511"><a href="#cb10-511"></a><span class="co">&lt;!-- ezpz_get_slurm_running_nodelist --&gt;</span></span>
<span id="cb10-512"><a href="#cb10-512"></a><span class="co">&lt;!-- ezpz_get_tstamp --&gt;</span></span>
<span id="cb10-513"><a href="#cb10-513"></a><span class="co">&lt;!-- ezpz_getjobenv_main --&gt;</span></span>
<span id="cb10-514"><a href="#cb10-514"></a><span class="co">&lt;!-- ezpz_make_slurm_nodefile --&gt;</span></span>
<span id="cb10-515"><a href="#cb10-515"></a><span class="co">&lt;!-- ezpz_parse_hostfile --&gt;</span></span>
<span id="cb10-516"><a href="#cb10-516"></a><span class="co">&lt;!-- ezpz_print_hosts --&gt;</span></span>
<span id="cb10-517"><a href="#cb10-517"></a><span class="co">&lt;!-- ezpz_print_job_env --&gt;</span></span>
<span id="cb10-518"><a href="#cb10-518"></a><span class="co">&lt;!-- ezpz_qsme_running --&gt;</span></span>
<span id="cb10-519"><a href="#cb10-519"></a><span class="co">&lt;!-- ezpz_reset_pbs_vars --&gt;</span></span>
<span id="cb10-520"><a href="#cb10-520"></a><span class="co">&lt;!-- ezpz_save_deepspeed_env --&gt;</span></span>
<span id="cb10-521"><a href="#cb10-521"></a><span class="co">&lt;!-- ezpz_save_dotenv --&gt;</span></span>
<span id="cb10-522"><a href="#cb10-522"></a><span class="co">&lt;!-- ezpz_save_ds_env --&gt;</span></span>
<span id="cb10-523"><a href="#cb10-523"></a><span class="co">&lt;!-- ezpz_save_pbs_env --&gt;</span></span>
<span id="cb10-524"><a href="#cb10-524"></a><span class="co">&lt;!-- ezpz_save_slurm_env --&gt;</span></span>
<span id="cb10-525"><a href="#cb10-525"></a><span class="co">&lt;!-- ezpz_savejobenv_main --&gt;</span></span>
<span id="cb10-526"><a href="#cb10-526"></a><span class="co">&lt;!-- ezpz_setup_alcf --&gt;</span></span>
<span id="cb10-527"><a href="#cb10-527"></a><span class="co">&lt;!-- ezpz_setup_conda --&gt;</span></span>
<span id="cb10-528"><a href="#cb10-528"></a><span class="co">&lt;!-- ezpz_setup_conda_aurora --&gt;</span></span>
<span id="cb10-529"><a href="#cb10-529"></a><span class="co">&lt;!-- ezpz_setup_conda_frontier --&gt;</span></span>
<span id="cb10-530"><a href="#cb10-530"></a><span class="co">&lt;!-- ezpz_setup_conda_polaris --&gt;</span></span>
<span id="cb10-531"><a href="#cb10-531"></a><span class="co">&lt;!-- ezpz_setup_conda_sirius --&gt;</span></span>
<span id="cb10-532"><a href="#cb10-532"></a><span class="co">&lt;!-- ezpz_setup_conda_sophia --&gt;</span></span>
<span id="cb10-533"><a href="#cb10-533"></a><span class="co">&lt;!-- ezpz_setup_conda_sunspot --&gt;</span></span>
<span id="cb10-534"><a href="#cb10-534"></a><span class="co">&lt;!-- ezpz_setup_host --&gt;</span></span>
<span id="cb10-535"><a href="#cb10-535"></a><span class="co">&lt;!-- ezpz_setup_host_old --&gt;</span></span>
<span id="cb10-536"><a href="#cb10-536"></a><span class="co">&lt;!-- ezpz_setup_host_pbs --&gt;</span></span>
<span id="cb10-537"><a href="#cb10-537"></a><span class="co">&lt;!-- ezpz_setup_host_slurm --&gt;</span></span>
<span id="cb10-538"><a href="#cb10-538"></a><span class="co">&lt;!-- ezpz_setup_job --&gt;</span></span>
<span id="cb10-539"><a href="#cb10-539"></a><span class="co">&lt;!-- --More-- --&gt;</span></span>
<span id="cb10-540"><a href="#cb10-540"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb10-541"><a href="#cb10-541"></a></span>
<span id="cb10-542"><a href="#cb10-542"></a><span class="co">&lt;!--</span></span>
<span id="cb10-543"><a href="#cb10-543"></a><span class="co">One of the major frustrations I had when running and testing distributed</span></span>
<span id="cb10-544"><a href="#cb10-544"></a><span class="co">applications was the amount of overhead needed simply to "run" the set of</span></span>
<span id="cb10-545"><a href="#cb10-545"></a><span class="co">commands I wanted to.</span></span>
<span id="cb10-546"><a href="#cb10-546"></a></span>
<span id="cb10-547"><a href="#cb10-547"></a><span class="co">We would like to write our applications in such a way that they are independent</span></span>
<span id="cb10-548"><a href="#cb10-548"></a><span class="co">of the machine, job scheduler and accelerator type used.</span></span>
<span id="cb10-549"><a href="#cb10-549"></a></span>
<span id="cb10-550"><a href="#cb10-550"></a><span class="co">are completely</span></span>
<span id="cb10-551"><a href="#cb10-551"></a><span class="co">independent of the details of our job scheduler</span></span>
<span id="cb10-552"><a href="#cb10-552"></a><span class="co">scale</span></span>
<span id="cb10-553"><a href="#cb10-553"></a><span class="co">automatically with the resources allocated by our job scheduler.</span></span>
<span id="cb10-554"><a href="#cb10-554"></a><span class="co">&lt;!--</span></span>
<span id="cb10-555"><a href="#cb10-555"></a><span class="co">In order to do this, we need a mechanism for determining the </span></span>
<span id="cb10-556"><a href="#cb10-556"></a><span class="co">the amount of resources ava</span></span>
<span id="cb10-557"><a href="#cb10-557"></a></span>
<span id="cb10-558"><a href="#cb10-558"></a><span class="co">In order to do this, there is some (relatively simple) setup and calculations</span></span>
<span id="cb10-559"><a href="#cb10-559"></a><span class="co">that must </span></span>
<span id="cb10-560"><a href="#cb10-560"></a></span>
<span id="cb10-561"><a href="#cb10-561"></a><span class="co">are able to run</span></span>
<span id="cb10-562"><a href="#cb10-562"></a><span class="co">on an arbitrary configuration of resources allocated</span></span>
<span id="cb10-563"><a href="#cb10-563"></a><span class="co">We provide a simple mechanism for dynamically setting up the runtime</span></span>
<span id="cb10-564"><a href="#cb10-564"></a></span>
<span id="cb10-565"><a href="#cb10-565"></a><span class="co">environment when allocated a set of resources through a job scheduler.</span></span>
<span id="cb10-566"><a href="#cb10-566"></a><span class="co">our environment to run python applications across any number of GPUs.</span></span>
<span id="cb10-567"><a href="#cb10-567"></a></span>
<span id="cb10-568"><a href="#cb10-568"></a><span class="co">environment to </span></span>
<span id="cb10-569"><a href="#cb10-569"></a><span class="co">&lt;!--</span></span>
<span id="cb10-570"><a href="#cb10-570"></a><span class="co">    on ALCF:</span></span>
<span id="cb10-571"><a href="#cb10-571"></a><span class="co">    setup conda + venv (creating if needed)</span></span>
<span id="cb10-572"><a href="#cb10-572"></a><span class="co">    from inside a {PBS, SLURM} job, this will:</span></span>
<span id="cb10-573"><a href="#cb10-573"></a><span class="co">    - do some sleuthing to determine specifics of active job </span></span>
<span id="cb10-574"><a href="#cb10-574"></a><span class="co">    - number of nodes available</span></span>
<span id="cb10-575"><a href="#cb10-575"></a><span class="co">    - how many GPUs are on each of them</span></span>
<span id="cb10-576"><a href="#cb10-576"></a><span class="co">    - what type of GPUs they are</span></span>
<span id="cb10-577"><a href="#cb10-577"></a><span class="co">    - what machine am I on</span></span>
<span id="cb10-578"><a href="#cb10-578"></a><span class="co">    - etc.</span></span>
<span id="cb10-579"><a href="#cb10-579"></a><span class="co">    then, with this information, we can fill in the details of the</span></span>
<span id="cb10-580"><a href="#cb10-580"></a><span class="co">    {mpirun,  mpiexec, srun} command that we will use to launch our</span></span>
<span id="cb10-581"><a href="#cb10-581"></a><span class="co">    executable (`python3`, in this case) across all the accelerators in our job.</span></span>
<span id="cb10-582"><a href="#cb10-582"></a><span class="co">&lt;!-- To setup Python, run: --&gt;</span></span>
<span id="cb10-583"><a href="#cb10-583"></a><span class="co">&lt;!----&gt;</span></span>
<span id="cb10-584"><a href="#cb10-584"></a><span class="co">&lt;!-- ```bash --&gt;</span></span>
<span id="cb10-585"><a href="#cb10-585"></a><span class="co">&lt;!-- ezpz_setup_python --&gt;</span></span>
<span id="cb10-586"><a href="#cb10-586"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb10-587"><a href="#cb10-587"></a><span class="co">&lt;!----&gt;</span></span>
<span id="cb10-588"><a href="#cb10-588"></a><span class="co">&lt;!-- which will automagically ‚ú® set up and activate an appropriate virtual --&gt;</span></span>
<span id="cb10-589"><a href="#cb10-589"></a><span class="co">&lt;!-- environment. --&gt;</span></span>
<span id="cb10-590"><a href="#cb10-590"></a><span class="co">&lt;!----&gt;</span></span>
<span id="cb10-591"><a href="#cb10-591"></a><span class="co">&lt;!-- ::: --&gt;</span></span>
<span id="cb10-592"><a href="#cb10-592"></a><span class="co">&lt;!--</span></span>
<span id="cb10-593"><a href="#cb10-593"></a><span class="co">::: {.callout-important title="Shell Utilities" collapsed=false}</span></span>
<span id="cb10-594"><a href="#cb10-594"></a><span class="co">We provide a variety of helper functions designed to make your life easier.</span></span>
<span id="cb10-595"><a href="#cb10-595"></a></span>
<span id="cb10-596"><a href="#cb10-596"></a><span class="co">They're:</span></span>
<span id="cb10-597"><a href="#cb10-597"></a></span>
<span id="cb10-598"><a href="#cb10-598"></a><span class="co">- entirely self-contained in [**`utils.sh`**](/ezpz/src/ezpz/bin/utils.sh)</span></span>
<span id="cb10-599"><a href="#cb10-599"></a><span class="co">- all prefixed with `ezpz_*`</span></span>
<span id="cb10-600"><a href="#cb10-600"></a></span>
<span id="cb10-601"><a href="#cb10-601"></a><span class="co">:::</span></span>
<span id="cb10-602"><a href="#cb10-602"></a></span>
<span id="cb10-603"><a href="#cb10-603"></a><span class="co">To take advantage of these helper functions we need to `source` this</span></span>
<span id="cb10-604"><a href="#cb10-604"></a><span class="co">[`utils.sh`](/ezpz/src/ezpz/bin/utils.sh).</span></span>
<span id="cb10-605"><a href="#cb10-605"></a></span>
<span id="cb10-606"><a href="#cb10-606"></a><span class="co">This can be done by:</span></span>
<span id="cb10-607"><a href="#cb10-607"></a></span>
<span id="cb10-608"><a href="#cb10-608"></a><span class="co">```bash</span></span>
<span id="cb10-609"><a href="#cb10-609"></a><span class="co">PBS_O_WORKDIR=$(pwd) source /dev/stdin &lt;&lt;&lt; $(curl 'https://raw.githubusercontent.com/saforem2/ezpz/refs/heads/main/src/ezpz/bin/utils.sh')</span></span>
<span id="cb10-610"><a href="#cb10-610"></a><span class="co">```</span></span>
<span id="cb10-611"><a href="#cb10-611"></a><span class="co">--&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/saforem2/personal_site/blob/main/posts/ezpz-at-alcf/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/saforem2/personal_site/edit/main/posts/ezpz-at-alcf/index.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/saforem2/personal_site/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>